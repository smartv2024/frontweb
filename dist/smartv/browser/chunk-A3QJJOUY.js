import{A as m,Aa as z,B as Te,Ba as Ze,C as Ve,Ca as q,D as ie,Da as He,E as r,Ea as Je,F as x,Fa as Ke,G as h,Ga as w,H as G,Ha as Qe,I as C,J as S,Ja as Xe,K as M,L as Ne,M as K,N as je,O as E,P as V,Q as Pe,R as Le,S as re,T as A,U as I,V as U,W as Fe,X as Re,Y as ze,a as k,b as Y,ba as We,c as Ce,d as Se,e as Me,f as ye,g as ke,ga as ae,h as ne,ha as Ue,i as Ae,ia as O,j as u,ja as de,k as v,ka as Be,l as Ie,la as Oe,m as Ee,n as J,na as qe,o as s,oa as D,p as _,pa as $,q as P,qa as T,r as oe,ra as N,s as f,sa as B,t as De,ta as j,u as l,ua as L,v as n,va as se,w as i,wa as Ye,x as p,xa as Ge,y,ya as F,z as g,za as R}from"./chunk-3SBVSYCC.js";var ce=class d{constructor(t){this.route=t}logout(){sessionStorage.clear(),sessionStorage.removeItem("authToken"),localStorage.removeItem("authToken"),localStorage.clear(),this.route.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(_(O))};static \u0275cmp=P({type:d,selectors:[["app-navbar"]],standalone:!1,decls:50,vars:0,consts:[[1,"navbar","navbar-expand-lg","navbar-dark","bg-dark","shadow-lg","sticky-top"],[1,"container"],["routerLink","/",1,"navbar-brand"],["src","https://iili.io/2gvDOlt.th.png","width","60","height","60",1,"d-inline-block","align-text-top","brand-logo"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto"],[1,"nav-item"],["routerLink","/admin","routerLinkActive","active-link",1,"nav-link"],[1,"fas","fa-home","me-2"],[1,"nav-item","dropdown"],["href","#","id","advertisementDropdown","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link","dropdown-toggle"],[1,"fas","fa-bullhorn","me-2"],["aria-labelledby","advertisementDropdown",1,"dropdown-menu","shadow-lg"],["routerLink","/admin/ads","routerLinkActive","active-link",1,"dropdown-item"],[1,"fas","fa-list","me-2"],["routerLink","/admin/newAds","routerLinkActive","active-link",1,"dropdown-item"],[1,"fas","fa-plus-circle","me-2"],["routerLink","/admin/archivedAds","routerLinkActive","active-link",1,"dropdown-item"],[1,"fas","fa-archive","me-2"],["href","#","id","devicesDropdown","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link","dropdown-toggle"],[1,"fas","fa-tablet-alt","me-2"],["aria-labelledby","devicesDropdown",1,"dropdown-menu","shadow-lg"],["routerLink","/admin/Devices","routerLinkActive","active-link",1,"dropdown-item"],["routerLink","/admin/addDevices","routerLinkActive","active-link",1,"dropdown-item"],["routerLink","/admin/archivedDevices","routerLinkActive","active-link",1,"dropdown-item"],["href","#",1,"btn","btn-glow","ms-3"],[1,"fas","fa-sign-out-alt","me-2"]],template:function(e,o){e&1&&(n(0,"nav",0)(1,"div",1)(2,"a",2),p(3,"img",3),i(),n(4,"button",4),p(5,"span",5),i(),n(6,"div",6)(7,"ul",7)(8,"li",8)(9,"a",9),p(10,"i",10),r(11," Accueil "),i()(),n(12,"li",11)(13,"a",12),p(14,"i",13),r(15," Advertisement "),i(),n(16,"ul",14)(17,"li")(18,"a",15),p(19,"i",16),r(20," Advertisement List "),i()(),n(21,"li")(22,"a",17),p(23,"i",18),r(24," Add Advertisement "),i()(),n(25,"li")(26,"a",19),p(27,"i",20),r(28," View Archived "),i()()()(),n(29,"li",11)(30,"a",21),p(31,"i",22),r(32," Devices "),i(),n(33,"ul",23)(34,"li")(35,"a",24),p(36,"i",16),r(37," Device List "),i()(),n(38,"li")(39,"a",25),p(40,"i",18),r(41," Add Device "),i()(),n(42,"li")(43,"a",26),p(44,"i",20),r(45," View Archived "),i()()()(),n(46,"li",8)(47,"a",27),p(48,"i",28),r(49," Logout "),i()()()()()())},dependencies:[de,Be],styles:['.navbar[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1f1f1f,#2c2c2c);box-shadow:0 8px 15px #00000080;transition:all .3s ease-in-out}.navbar[_ngcontent-%COMP%]:hover{box-shadow:0 10px 20px #000000b3}.navbar-brand[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1.5rem;font-weight:700;text-transform:uppercase;color:#fff;transition:color .3s ease-in-out}.navbar-brand[_ngcontent-%COMP%]:hover{color:#00ffc3}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{position:relative;font-size:1rem;font-weight:500;color:#fff;display:flex;align-items:center;transition:all .3s ease}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem;color:#00ffc3;transition:transform .3s ease-in-out}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:#00ffc3;text-shadow:0px 4px 6px rgba(0,255,195,.6)}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.2)}.btn-glow[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:10px 15px;border-radius:50px;font-size:1rem;font-weight:700;text-transform:uppercase;box-shadow:0 8px 15px #dc354566;transition:all .3s ease-in-out;display:flex;align-items:center}.btn-glow[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem}.btn-glow[_ngcontent-%COMP%]:hover{background-color:tomato;color:#fff;box-shadow:0 10px 20px #ff634799;transform:scale(1.1)}.btn-glow[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:rotate(360deg)}@media (max-width: 768px){.navbar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{margin-bottom:10px}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{text-align:center;font-size:1.1rem}.btn-glow[_ngcontent-%COMP%]{width:100%}}.active-link[_ngcontent-%COMP%]{color:#00ffc3!important;text-shadow:0px 4px 6px rgba(0,255,195,.6);font-weight:700;position:relative}.active-link[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-4px;left:0;width:100%;height:2px;background:#00ffc3;border-radius:5px}.navbar-nav[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2a2a2a,#333);border:none;border-radius:.5rem;box-shadow:0 8px 15px #0006}.navbar-nav[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{color:#fff;font-size:.9rem;transition:background-color .3s ease}.navbar-nav[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:hover{background-color:#444;color:#00ffc3}']})};var le=class d{constructor(t){this.router=t}ngOnInit(){this.checkAuthentication()}checkAuthentication(){sessionStorage.getItem("authToken")||this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(_(O))};static \u0275cmp=P({type:d,selectors:[["app-admin"]],standalone:!1,decls:2,vars:0,template:function(e,o){e&1&&p(0,"app-navbar")(1,"router-outlet")},dependencies:[Ue,ce],encapsulation:2})};function rt(d,t){if(d&1){let e=y();n(0,"button",24),g("click",function(){u(e);let a=m().$implicit,c=m();return v(c.confirmArchive(a._id))}),p(1,"i",25),i()}}function at(d,t){if(d&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),E(9,"titlecase"),i(),n(10,"td")(11,"a",17),g("click",function(){let a=u(e).$implicit,c=m();return v(c.openModal(a.videoUrl))}),p(12,"i",18),r(13," View Video "),i()(),n(14,"td")(15,"button",19),g("click",function(){let a=u(e).$implicit,c=m();return v(c.openEditModal(a))}),p(16,"i",20),i(),f(17,rt,2,0,"button",21),n(18,"button",22),g("click",function(){let a=u(e).$implicit,c=m();return v(c.deleteAdvertisement(a._id))}),p(19,"i",23),i()()()}if(d&2){let e=t.$implicit,o=t.index;s(2),x(o+1),s(2),x(e.name),s(2),x(e.description),s(2),x(V(9,5,e.orientation)),s(9),l("ngIf",!e.archived)}}function dt(d,t){if(d&1&&p(0,"video",33),d&2){let e=m(2);l("src",e.selectedVideoUrl,J)}}function st(d,t){if(d&1){let e=y();n(0,"div",26)(1,"div",27),g("click",function(){u(e);let a=m();return v(a.closeModal())}),i(),n(2,"div",28)(3,"button",29),g("click",function(){u(e);let a=m();return v(a.closeModal())}),r(4,"\u2716"),i(),n(5,"h5",30),r(6,"Advertisement Video"),i(),n(7,"div",31),f(8,dt,1,1,"video",32),i()()()}if(d&2){let e=m();s(8),l("ngIf",e.selectedVideoUrl)}}function ct(d,t){if(d&1&&(n(0,"option",49),r(1),E(2,"titlecase"),i()),d&2){let e=t.$implicit;l("value",e),s(),h(" ",V(2,2,e)," ")}}function lt(d,t){if(d&1){let e=y();n(0,"div",34)(1,"div",35),g("click",function(){u(e);let a=m();return v(a.closeEditModal())}),i(),n(2,"div",36)(3,"button",29),g("click",function(){u(e);let a=m();return v(a.closeEditModal())}),r(4,"\u2716"),i(),n(5,"h5",30),r(6,"Edit Advertisement"),i(),n(7,"form",37),g("ngSubmit",function(){u(e);let a=m();return v(a.updateAdvertisement())}),n(8,"div",38)(9,"label",39),r(10,"Name"),i(),n(11,"input",40),M("ngModelChange",function(a){u(e);let c=m();return S(c.editAdvertisementObject.name,a)||(c.editAdvertisementObject.name=a),v(a)}),i()(),n(12,"div",38)(13,"label",41),r(14,"Description"),i(),n(15,"textarea",42),M("ngModelChange",function(a){u(e);let c=m();return S(c.editAdvertisementObject.description,a)||(c.editAdvertisementObject.description=a),v(a)}),i()(),n(16,"div",38)(17,"label",43),r(18,"Orientation"),i(),n(19,"select",44),M("ngModelChange",function(a){u(e);let c=m();return S(c.editAdvertisementObject.orientation,a)||(c.editAdvertisementObject.orientation=a),v(a)}),f(20,ct,3,4,"option",45),i()(),n(21,"div",38)(22,"label",46),r(23,"Video URL"),i(),n(24,"input",47),M("ngModelChange",function(a){u(e);let c=m();return S(c.editAdvertisementObject.videoUrl,a)||(c.editAdvertisementObject.videoUrl=a),v(a)}),i()(),n(25,"button",48),r(26,"Update"),i()()()()}if(d&2){let e=m();s(11),C("ngModel",e.editAdvertisementObject.name),s(4),C("ngModel",e.editAdvertisementObject.description),s(4),C("ngModel",e.editAdvertisementObject.orientation),s(),l("ngForOf",e.orientations),s(4),C("ngModel",e.editAdvertisementObject.videoUrl)}}function mt(d,t){if(d&1){let e=y();n(0,"div",26)(1,"div",27),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),i(),n(2,"div",28)(3,"h5",30),r(4,"Confirm Archive"),i(),n(5,"p"),r(6,"Are you sure you want to archive this advertisement?"),i(),n(7,"div",50)(8,"button",51),g("click",function(){u(e);let a=m();return v(a.archiveAd(a.archivingAdId))}),r(9,"Yes"),i(),n(10,"button",52),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),r(11,"No"),i()()()()}}var me=class d{constructor(t,e){this.adminService=t;this.router=e}advertisements=[];successMessage="";searchTerm="";errorMessage="";selectedVideoUrl="";isModalOpen=!1;isEditModalOpen=!1;isConfirmDialogOpen=!1;archivingAdId="";editAdvertisementObject={};orientations=["portrait","landscape"];currentPage=1;itemsPerPage=5;filteredAds=[];ngOnInit(){this.loadAdvertisements()}loadAdvertisements(){this.adminService.getAds().subscribe(t=>{this.advertisements=(t.data||[]).filter(e=>e.isDeleted===!1),this.filteredAds=[...this.advertisements]},t=>{this.errorMessage=t.error?.message||"Failed to load advertisements."})}filteredAdvertisements(){if(!this.searchTerm)this.filteredAds=this.advertisements;else{let t=this.searchTerm.toLowerCase();this.filteredAds=this.advertisements.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.orientation.toLowerCase().includes(t))}return this.paginatedAdvertisements()}paginatedAdvertisements(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredAds.slice(t,e)}get totalPages(){return Math.ceil(this.filteredAds.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}openModal(t){this.selectedVideoUrl=t,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}openEditModal(t){this.editAdvertisementObject=k({},t),this.isEditModalOpen=!0}closeEditModal(){this.isEditModalOpen=!1}updateAdvertisement(){this.adminService.updateAd(this.editAdvertisementObject._id,this.editAdvertisementObject).subscribe(()=>{this.successMessage="Advertisement updated successfully!",this.isEditModalOpen=!1,this.loadAdvertisements()},t=>{console.error("Error updating advertisement:",t),this.errorMessage=t.error?.message||"Failed to update advertisement."})}confirmArchive(t){this.archivingAdId=t,this.isConfirmDialogOpen=!0}archiveAd(t){this.adminService.archiveAds(t).subscribe(()=>{this.successMessage="Advertisement archived successfully!",this.loadAdvertisements(),this.closeConfirmDialog()},e=>{console.error("Error archiving advertisement:",e),this.errorMessage=e.error?.message||"Failed to archive advertisement."})}closeConfirmDialog(){this.isConfirmDialogOpen=!1,this.archivingAdId=""}navigateToAddAdvertisement(){this.router.navigate(["/admin/newAds"])}checkVideoResolution(t){let e={width:1920,height:1080},o=this.getVideoResolution(t);return o.width<=e.width&&o.height<=e.height}getVideoResolution(t){return{width:1280,height:720}}deleteAdvertisement(t){this.adminService.deleteAdById(t).subscribe(()=>{this.successMessage="Advertisement deleted successfully!",this.loadAdvertisements()},e=>{this.errorMessage=e.error?.message||"Failed to delete advertisement."})}static \u0275fac=function(e){return new(e||d)(_(w),_(O))};static \u0275cmp=P({type:d,selectors:[["app-advertisement"]],standalone:!1,decls:40,vars:9,consts:[[1,"container","ad-list-container"],[1,"list-title"],[1,"row"],[1,"col"],[1,"header-section"],[1,"btn","btn-primary","add-ad-btn","mb-2",3,"click"],[1,"fas","fa-plus-circle","me-2"],[1,"search-container"],["type","text","placeholder","Search advertisements...",1,"form-control","search-input",3,"ngModelChange","ngModel"],[1,"table-responsive"],[1,"table","ad-table"],[4,"ngFor","ngForOf"],[1,"pagination-container"],[1,"btn","btn-secondary","me-2",3,"click","disabled"],[1,"btn","btn-secondary","ms-2",3,"click","disabled"],["class","custom-modal",4,"ngIf"],["class","edit-modal",4,"ngIf"],["href","javascript:void(0)",1,"video-link",3,"click"],[1,"fas","fa-video","me-2"],[1,"btn","btn-warning","me-2",3,"click"],[1,"fas","fa-edit"],["class","btn btn-info",3,"click",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"fas","fa-trash-alt"],[1,"btn","btn-info",3,"click"],[1,"fas","fa-archive"],[1,"custom-modal"],[1,"modal-overlay",3,"click"],[1,"modal-content"],[1,"modal-close",3,"click"],[1,"modal-title"],[1,"video-container"],["controls","","class","modal-video",3,"src",4,"ngIf"],["controls","",1,"modal-video",3,"src"],[1,"edit-modal"],[1,"edit-modal-overlay",3,"click"],[1,"edit-modal-content"],[3,"ngSubmit"],[1,"form-group"],["for","name"],["id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","orientation"],["id","orientation","name","orientation",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","videoUrl"],["id","videoUrl","name","videoUrl","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary"],[3,"value"],[1,"dialog-actions"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-secondary",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h2",1),r(2,"Advertisement List"),i(),n(3,"div",2)(4,"div",3)(5,"div",4)(6,"button",5),g("click",function(){return o.navigateToAddAdvertisement()}),p(7,"i",6),r(8," Add Advertisement "),i()()(),n(9,"div",3)(10,"div",7)(11,"input",8),M("ngModelChange",function(c){return S(o.searchTerm,c)||(o.searchTerm=c),c}),i()()()(),n(12,"div",9)(13,"table",10)(14,"thead")(15,"tr")(16,"th"),r(17,"#"),i(),n(18,"th"),r(19,"Name"),i(),n(20,"th"),r(21,"Description"),i(),n(22,"th"),r(23,"Orientation"),i(),n(24,"th"),r(25,"Video URL"),i(),n(26,"th"),r(27,"Actions"),i()()(),n(28,"tbody"),f(29,at,20,7,"tr",11),i()()(),n(30,"div",12)(31,"button",13),g("click",function(){return o.previousPage()}),r(32," Previous "),i(),n(33,"span"),r(34),i(),n(35,"button",14),g("click",function(){return o.nextPage()}),r(36," Next "),i()(),f(37,st,9,1,"div",15)(38,lt,27,5,"div",16)(39,mt,12,0,"div",15),i()),e&2&&(s(11),C("ngModel",o.searchTerm),s(18),l("ngForOf",o.filteredAdvertisements()),s(2),l("disabled",o.currentPage===1),s(3),G("Page ",o.currentPage," of ",o.totalPages,""),s(),l("disabled",o.currentPage===o.totalPages),s(2),l("ngIf",o.isModalOpen),s(),l("ngIf",o.isEditModalOpen),s(),l("ngIf",o.isConfirmDialogOpen))},dependencies:[A,I,L,R,z,D,F,T,N,q,j,B,U],styles:[".alert[_ngcontent-%COMP%]{margin-bottom:15px;border-radius:5px;padding:10px 15px;text-align:center}.ad-table[_ngcontent-%COMP%]{width:100%;border-radius:15px;overflow:hidden;box-shadow:0 8px 15px #0000001a;margin-bottom:30px}.table-header[_ngcontent-%COMP%]{background:#007bff;color:#fff;font-size:1.2rem;text-transform:uppercase}.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;padding:20px;vertical-align:middle;font-size:1rem}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s ease,box-shadow .3s ease;height:60px}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1;box-shadow:0 5px 10px #0000001a}.video-link[_ngcontent-%COMP%]{color:#007bff;text-decoration:none;font-weight:700}.video-link[_ngcontent-%COMP%]:hover{color:#0056b3;text-decoration:underline}.btn[_ngcontent-%COMP%]{padding:8px 15px;font-size:1rem;border-radius:50px;transition:background .3s ease,transform .2s ease}.btn-archive[_ngcontent-%COMP%]{background:#dc3545;color:#fff;border:none}.btn-archive[_ngcontent-%COMP%]:hover{background:#b02a37;transform:translateY(-2px)}.btn-unarchive[_ngcontent-%COMP%]{background:#28a745;color:#fff;border:none}.btn-unarchive[_ngcontent-%COMP%]:hover{background:#1e7e34;transform:translateY(-2px)}@media (max-width: 768px){.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;font-size:.9rem}.ad-list-container[_ngcontent-%COMP%]{padding:10px}}.custom-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:1}.modal-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;text-align:center;width:70%;max-width:500px}.modal-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:15px;color:#333}.modal-video[_ngcontent-%COMP%]{width:100%;height:auto;max-height:400px;border-radius:10px}.modal-close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:1.5rem;cursor:pointer;color:#666}.modal-close[_ngcontent-%COMP%]:hover{color:#000}.confirmation-dialog[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.confirmation-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080}.confirmation-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;text-align:center;width:90%;max-width:400px}.confirmation-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:10px}.confirmation-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-top:20px}.btn-confirm-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:10px 15px;border-radius:5px;cursor:pointer}.btn-confirm-danger[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-confirm-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;border:none;padding:10px 15px;border-radius:5px;cursor:pointer}.btn-confirm-secondary[_ngcontent-%COMP%]:hover{background-color:#545b62}.edit-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.edit-modal-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080}.edit-modal-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;width:90%;max-width:500px;text-align:center}.edit-modal[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:1.5rem;cursor:pointer}.edit-modal[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:#000}.edit-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{text-align:left}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;color:#333;display:block;margin-bottom:5px}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{appearance:none;background:#fff}.edit-modal[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 15px;border-radius:5px;font-size:1rem;font-weight:700;cursor:pointer;transition:background-color .3s ease}.edit-modal[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3}.ad-list-container[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background:#f9f9f9;border-radius:15px;box-shadow:0 8px 20px #0003}.list-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;text-align:center;margin-bottom:20px;color:#333}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:1rem;box-shadow:0 2px 4px #0000001a}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 4px #007bff80}.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;gap:10px}.pagination-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:1rem;border-radius:5px;cursor:pointer}.pagination-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6}.pagination-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:700}"]})};function pt(d,t){if(d&1&&(n(0,"div",31),p(1,"i",32),r(2),i()),d&2){let e=m();s(2),h("",e.successMessage," ")}}function gt(d,t){if(d&1&&(n(0,"div",33),p(1,"i",34),r(2),i()),d&2){let e=m();s(2),h("",e.errorMessage," ")}}function ut(d,t){if(d&1&&(n(0,"div",35),r(1),i()),d&2){let e=m();s(),h(" ",e.videoResolutionError," ")}}function vt(d,t){if(d&1&&(n(0,"option",36),r(1),E(2,"titlecase"),i()),d&2){let e=t.$implicit;l("value",e),s(),h(" ",V(2,2,e)," ")}}function ft(d,t){d&1&&p(0,"span",37)}function ht(d,t){d&1&&p(0,"i",38)}function _t(d,t){d&1&&(n(0,"span"),r(1,"Submit"),i())}var pe=class d{constructor(t,e){this.adminService=t;this.router=e}advertisementObject={name:"",description:"",videoUrl:"",orientation:""};orientations=["portrait","landscape"];isSubmitting=!1;successMessage="";errorMessage="";videoResolutionError="";validateVideoResolution(t){let o=t.target.value;this.videoResolutionError="",o&&this.getMediaDimensions(o).then(a=>{console.log("Video Dimensions:",a),(a.width>1920||a.height>1080)&&(this.videoResolutionError="The video resolution exceeds the maximum allowed size of 1920x1080.",this.advertisementObject.videoUrl="")}).catch(a=>{console.error("Error fetching video dimensions:",a),this.videoResolutionError="Unable to validate video resolution. Please provide a valid video URL.",this.advertisementObject.videoUrl=""})}getMediaDimensions(t){return new Promise((e,o)=>{let a=document.createElement("video");a.src=t,a.onloadedmetadata=()=>{e({width:a.videoWidth,height:a.videoHeight})},a.onerror=()=>{o("Failed to load video metadata.")}})}addAdvertisement(){this.isSubmitting=!0,this.successMessage="",this.errorMessage="",this.adminService.addAds(this.advertisementObject).subscribe(t=>{console.log("Advertisement added:",t),this.successMessage="Advertisement added successfully!",this.isSubmitting=!1,this.advertisementObject={name:"",description:"",videoUrl:"",orientation:""}},t=>{console.error("Error adding advertisement:",t),this.errorMessage=t.error?.message||"Failed to add advertisement. Please try again.",this.isSubmitting=!1})}navigateToList(){this.router.navigate(["/admin/ads"])}getVideoResolution(t){return{width:1280,height:720}}checkVideoResolution(t){let e={width:1920,height:1080},o=this.getVideoResolution(t);return o.width>e.width||o.height>e.height?"The video resolution exceeds the maximum allowed size of 1920x1080.":""}static \u0275fac=function(e){return new(e||d)(_(w),_(O))};static \u0275cmp=P({type:d,selectors:[["app-add-advertisement"]],standalone:!1,decls:41,vars:12,consts:[["adForm","ngForm"],[1,"container","form-container"],[1,"form-card"],[1,"back-button","mb-5"],[1,"btn-back",3,"click"],[1,"fas","fa-arrow-left","me-2"],[1,"form-title"],[1,"fas","fa-ad","me-2"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"ngSubmit"],[1,"form-group"],["for","name"],[1,"fas","fa-tag","me-2"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],[1,"fas","fa-align-left","me-2"],["id","description","name","description","rows","3","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","videoUrl"],[1,"fas","fa-link","me-2"],["type","url","id","videoUrl","name","videoUrl","required","",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-text","text-muted"],["class","text-danger mt-1",4,"ngIf"],["for","orientation"],[1,"fas","fa-arrows-alt","me-2"],["id","orientation","name","orientation","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","submit",1,"btn-submit",3,"disabled"],["class","spinner",4,"ngIf"],["class","fas fa-paper-plane me-2",4,"ngIf"],[4,"ngIf"],["role","alert",1,"alert","alert-success"],[1,"fas","fa-check-circle","me-2"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-circle","me-2"],[1,"text-danger","mt-1"],[3,"value"],[1,"spinner"],[1,"fas","fa-paper-plane","me-2"]],template:function(e,o){if(e&1){let a=y();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),g("click",function(){return u(a),v(o.navigateToList())}),p(4,"i",5),r(5,"Back to List "),i()(),n(6,"h2",6),p(7,"i",7),r(8,"Add Advertisement "),i(),f(9,pt,3,1,"div",8)(10,gt,3,1,"div",9),n(11,"form",10,0),g("ngSubmit",function(){return u(a),v(o.addAdvertisement())}),n(13,"div",11)(14,"label",12),p(15,"i",13),r(16,"Name "),i(),n(17,"input",14),M("ngModelChange",function(b){return u(a),S(o.advertisementObject.name,b)||(o.advertisementObject.name=b),v(b)}),i()(),n(18,"div",11)(19,"label",15),p(20,"i",16),r(21,"Description "),i(),n(22,"textarea",17),M("ngModelChange",function(b){return u(a),S(o.advertisementObject.description,b)||(o.advertisementObject.description=b),v(b)}),i()(),n(23,"div",11)(24,"label",18),p(25,"i",19),r(26,"Video URL "),i(),n(27,"input",20),M("ngModelChange",function(b){return u(a),S(o.advertisementObject.videoUrl,b)||(o.advertisementObject.videoUrl=b),v(b)}),g("change",function(b){return u(a),v(o.validateVideoResolution(b))}),i(),n(28,"small",21),r(29," Note: The video resolution should not exceed 1920x1080. "),i(),f(30,ut,2,1,"div",22),i(),n(31,"div",11)(32,"label",23),p(33,"i",24),r(34,"Orientation "),i(),n(35,"select",25),M("ngModelChange",function(b){return u(a),S(o.advertisementObject.orientation,b)||(o.advertisementObject.orientation=b),v(b)}),f(36,vt,3,4,"option",26),i()(),n(37,"button",27),f(38,ft,1,0,"span",28)(39,ht,1,0,"i",29)(40,_t,2,0,"span",30),i()()()()}if(e&2){let a=ie(12);s(9),l("ngIf",o.successMessage),s(),l("ngIf",o.errorMessage),s(7),C("ngModel",o.advertisementObject.name),s(5),C("ngModel",o.advertisementObject.description),s(5),C("ngModel",o.advertisementObject.videoUrl),s(3),l("ngIf",o.videoResolutionError),s(5),C("ngModel",o.advertisementObject.orientation),s(),l("ngForOf",o.orientations),s(),l("disabled",o.isSubmitting||!a.form.valid),s(),l("ngIf",o.isSubmitting),s(),l("ngIf",!o.isSubmitting),s(),l("ngIf",!o.isSubmitting)}},dependencies:[A,I,L,R,z,D,F,T,N,q,j,B,U],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;box-shadow:0 10px 20px #0000001a;padding:40px 50px;width:100%;max-width:500px;animation:_ngcontent-%COMP%_fadeIn .8s ease-in-out;text-align:center;transition:transform .3s ease,box-shadow .3s ease}.form-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 15px 30px #00000026}.form-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:25px;color:#333;text-shadow:0px 4px 8px rgba(0,0,0,.2)}.form-group[_ngcontent-%COMP%]{margin-bottom:25px;text-align:left}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin-bottom:10px;color:#555}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;transition:box-shadow .3s ease,border-color .3s ease;background:#f9f9f9}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#007bff;box-shadow:0 5px 10px #007bff4d;outline:none;background:#fff}.btn-submit[_ngcontent-%COMP%]{background:linear-gradient(135deg,#007bff,#0056b3);color:#fff;border:none;padding:12px 20px;border-radius:50px;font-size:1rem;font-weight:700;cursor:pointer;box-shadow:0 8px 15px #007bff66;transition:all .3s ease;display:inline-flex;align-items:center;justify-content:center;gap:10px}.btn-submit[_ngcontent-%COMP%]:disabled{background:#ccc;color:#999;cursor:not-allowed;box-shadow:none}.btn-submit[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#0056b3,#003f7f);transform:translateY(-2px);box-shadow:0 12px 20px #0056b380}.btn-submit[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 5px 10px #007bff4d}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f3f3;border-top:3px solid #007bff;border-radius:50%;width:18px;height:18px;animation:_ngcontent-%COMP%_spin .8s linear infinite}.alert[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1rem;border-radius:10px;padding:10px 15px;text-align:center;animation:_ngcontent-%COMP%_fadeIn .5s ease}.alert-success[_ngcontent-%COMP%]{background-color:#e6ffe6;color:#28a745;border:1px solid #28a745}.alert-danger[_ngcontent-%COMP%]{background-color:#ffe6e6;color:#dc3545;border:1px solid #dc3545}.back-button[_ngcontent-%COMP%]{margin-bottom:20px;text-align:left}.btn-back[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:10px 20px;border-radius:50px;font-size:1rem;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 15px #6c757d66}.btn-back[_ngcontent-%COMP%]:hover{background:#5a6268;transform:translateY(-2px);box-shadow:0 10px 20px #5a626880}.btn-back[_ngcontent-%COMP%]:active{transform:translateY(2px)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:20px 30px}.btn-submit[_ngcontent-%COMP%], .btn-back[_ngcontent-%COMP%]{padding:10px 15px}}"]})};function bt(d,t){if(d&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),E(9,"titlecase"),i(),n(10,"td")(11,"a",13),g("click",function(){let a=u(e).$implicit,c=m();return v(c.openModal(a.videoUrl))}),p(12,"i",14),r(13," View Video "),i()(),n(14,"td")(15,"button",15),g("click",function(){let a=u(e).$implicit,c=m();return v(c.confirmArchive(a._id))}),p(16,"i",16),r(17," Unarchive "),i()()()}if(d&2){let e=t.$implicit,o=t.index,a=m();s(2),x(o+1+(a.currentPage-1)*a.itemsPerPage),s(2),x(e.name),s(2),x(e.description),s(2),x(V(9,4,e.orientation))}}function xt(d,t){if(d&1&&p(0,"video",24),d&2){let e=m(2);l("src",e.selectedVideoUrl,J)}}function Ct(d,t){if(d&1){let e=y();n(0,"div",17)(1,"div",18),g("click",function(){u(e);let a=m();return v(a.closeModal())}),i(),n(2,"div",19)(3,"button",20),g("click",function(){u(e);let a=m();return v(a.closeModal())}),r(4,"\u2716"),i(),n(5,"h5",21),r(6,"Advertisement Video"),i(),n(7,"div",22),f(8,xt,1,1,"video",23),i()()()}if(d&2){let e=m();s(8),l("ngIf",e.selectedVideoUrl)}}function St(d,t){if(d&1){let e=y();n(0,"div",17)(1,"div",18),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),i(),n(2,"div",19)(3,"h5",21),r(4,"Confirm Unarchive"),i(),n(5,"p"),r(6,"Are you sure you want to unarchive this advertisement?"),i(),n(7,"div",25)(8,"button",15),g("click",function(){u(e);let a=m();return v(a.unarchiveAd(a.archivingAdId))}),r(9," Yes "),i(),n(10,"button",26),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),r(11," No "),i()()()()}}var ge=class d{constructor(t){this.adminService=t}advertisements=[];filteredAds=[];successMessage="";errorMessage="";selectedVideoUrl="";isModalOpen=!1;isConfirmDialogOpen=!1;archivingAdId="";currentPage=1;itemsPerPage=5;searchTerm="";ngOnInit(){this.loadAdvertisements()}loadAdvertisements(){this.adminService.getAds().subscribe(t=>{this.advertisements=(t.data||[]).filter(e=>e.isDeleted===!0),this.filteredAds=[...this.advertisements]},t=>{console.error("Error fetching advertisements:",t),this.errorMessage=t.error?.message||"Failed to load advertisements."})}filteredAdvertisements(){if(!this.searchTerm)this.filteredAds=this.advertisements;else{let t=this.searchTerm.toLowerCase();this.filteredAds=this.advertisements.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.orientation.toLowerCase().includes(t))}return this.paginatedAdvertisements()}paginatedAdvertisements(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredAds.slice(t,e)}get totalPages(){return Math.ceil(this.filteredAds.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}openModal(t){this.selectedVideoUrl=t,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}confirmArchive(t){this.archivingAdId=t,this.isConfirmDialogOpen=!0}unarchiveAd(t){this.adminService.unarchiveAds(t).subscribe(()=>{this.successMessage="Advertisement unarchived successfully!",this.loadAdvertisements(),this.closeConfirmDialog()},e=>{console.error("Error unarchiving advertisement:",e),this.errorMessage=e.error?.message||"Failed to unarchive advertisement."})}closeConfirmDialog(){this.isConfirmDialogOpen=!1,this.archivingAdId=""}static \u0275fac=function(e){return new(e||d)(_(w))};static \u0275cmp=P({type:d,selectors:[["app-archiv-ads"]],standalone:!1,decls:34,vars:8,consts:[[1,"container","ad-list-container"],[1,"list-title"],[1,"row","mb-3"],[1,"col-md-6"],[1,"search-container"],["type","text","placeholder","Search advertisements...",1,"form-control","search-input",3,"ngModelChange","ngModel"],[1,"table-responsive"],[1,"table","ad-table"],[4,"ngFor","ngForOf"],[1,"pagination-container"],[1,"btn","btn-secondary","me-2",3,"click","disabled"],[1,"btn","btn-secondary","ms-2",3,"click","disabled"],["class","custom-modal",4,"ngIf"],["href","javascript:void(0)",1,"video-link",3,"click"],[1,"fas","fa-video","me-2"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-undo","me-2"],[1,"custom-modal"],[1,"modal-overlay",3,"click"],[1,"modal-content"],[1,"modal-close",3,"click"],[1,"modal-title"],[1,"video-container"],["controls","","class","modal-video",3,"src",4,"ngIf"],["controls","",1,"modal-video",3,"src"],[1,"dialog-actions"],[1,"btn","btn-secondary",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h2",1),r(2,"Archived Advertisement List"),i(),n(3,"div",2)(4,"div",3)(5,"div",4)(6,"input",5),M("ngModelChange",function(c){return S(o.searchTerm,c)||(o.searchTerm=c),c}),i()()()(),n(7,"div",6)(8,"table",7)(9,"thead")(10,"tr")(11,"th"),r(12,"#"),i(),n(13,"th"),r(14,"Name"),i(),n(15,"th"),r(16,"Description"),i(),n(17,"th"),r(18,"Orientation"),i(),n(19,"th"),r(20,"Video URL"),i(),n(21,"th"),r(22,"Actions"),i()()(),n(23,"tbody"),f(24,bt,18,6,"tr",8),i()()(),n(25,"div",9)(26,"button",10),g("click",function(){return o.previousPage()}),r(27," Previous "),i(),n(28,"span"),r(29),i(),n(30,"button",11),g("click",function(){return o.nextPage()}),r(31," Next "),i()(),f(32,Ct,9,1,"div",12)(33,St,12,0,"div",12),i()),e&2&&(s(6),C("ngModel",o.searchTerm),s(18),l("ngForOf",o.filteredAdvertisements()),s(2),l("disabled",o.currentPage===1),s(3),G("Page ",o.currentPage," of ",o.totalPages,""),s(),l("disabled",o.currentPage===o.totalPages),s(2),l("ngIf",o.isModalOpen),s(),l("ngIf",o.isConfirmDialogOpen))},dependencies:[A,I,D,T,j,U],styles:[".alert[_ngcontent-%COMP%]{margin-bottom:15px;border-radius:5px;padding:10px 15px;text-align:center}.ad-table[_ngcontent-%COMP%]{width:100%;border-radius:15px;overflow:hidden;box-shadow:0 8px 15px #0000001a;margin-bottom:30px}.table-header[_ngcontent-%COMP%]{background:#007bff;color:#fff;font-size:1.2rem;text-transform:uppercase}.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;padding:20px;vertical-align:middle;font-size:1rem}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s ease,box-shadow .3s ease;height:60px}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1;box-shadow:0 5px 10px #0000001a}.video-link[_ngcontent-%COMP%]{color:#007bff;text-decoration:none;font-weight:700}.video-link[_ngcontent-%COMP%]:hover{color:#0056b3;text-decoration:underline}.btn[_ngcontent-%COMP%]{padding:8px 15px;font-size:1rem;border-radius:50px;transition:background .3s ease,transform .2s ease}.btn-archive[_ngcontent-%COMP%]{background:#168c57;color:#fff;border:none}.btn-archive[_ngcontent-%COMP%]:hover{background:#b02a37;transform:translateY(-2px)}.btn-unarchive[_ngcontent-%COMP%]{background:#28a745;color:#fff;border:none}.btn-unarchive[_ngcontent-%COMP%]:hover{background:#1e7e34;transform:translateY(-2px)}@media (max-width: 768px){.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;font-size:.9rem}.ad-list-container[_ngcontent-%COMP%]{padding:10px}}.custom-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:1}.modal-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;text-align:center;width:70%;max-width:500px}.modal-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:15px;color:#333}.modal-video[_ngcontent-%COMP%]{width:100%;height:auto;max-height:400px;border-radius:10px}.modal-close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:1.5rem;cursor:pointer;color:#666}.modal-close[_ngcontent-%COMP%]:hover{color:#000}.confirmation-dialog[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.confirmation-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080}.confirmation-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;text-align:center;width:90%;max-width:400px}.confirmation-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:10px}.confirmation-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-top:20px}.btn-confirm-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:10px 15px;border-radius:5px;cursor:pointer}.btn-confirm-danger[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-confirm-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;border:none;padding:10px 15px;border-radius:5px;cursor:pointer}.btn-confirm-secondary[_ngcontent-%COMP%]:hover{background-color:#545b62}.edit-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.edit-modal-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080}.edit-modal-content[_ngcontent-%COMP%]{position:relative;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0000004d;z-index:2;width:90%;max-width:500px;text-align:center}.edit-modal[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:1.5rem;cursor:pointer}.edit-modal[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:#000}.edit-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{text-align:left}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;color:#333;display:block;margin-bottom:5px}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}.edit-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{appearance:none;background:#fff}.edit-modal[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 15px;border-radius:5px;font-size:1rem;font-weight:700;cursor:pointer;transition:background-color .3s ease}.edit-modal[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3}.ad-list-container[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background:#f9f9f9;border-radius:15px;box-shadow:0 8px 20px #0003}.list-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;text-align:center;margin-bottom:20px;color:#333}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:1rem;box-shadow:0 2px 4px #0000001a}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 4px #007bff80}.ad-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ad-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}.ad-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;gap:10px}.pagination-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:1rem;border-radius:5px;cursor:pointer}.pagination-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6}.pagination-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:700}"]})};function Mt(d,t){if(d&1&&(n(0,"div",25),p(1,"i",26),r(2),i()),d&2){let e=m();s(2),h("",e.successMessage," ")}}function yt(d,t){if(d&1&&(n(0,"div",27),p(1,"i",28),r(2),i()),d&2){let e=m();s(2),h("",e.errorMessage," ")}}function Pt(d,t){if(d&1&&(n(0,"option",29),r(1),E(2,"titlecase"),i()),d&2){let e=t.$implicit;l("value",e),s(),h(" ",V(2,2,e)," ")}}function Ot(d,t){d&1&&p(0,"span",30)}function wt(d,t){d&1&&p(0,"i",31)}function kt(d,t){d&1&&(n(0,"span"),r(1,"Submit"),i())}var ue=class d{constructor(t,e){this.adminService=t;this.router=e}deviceObject={name:"",description:"",orientation:""};orientations=["portrait","landscape"];isSubmitting=!1;successMessage="";errorMessage="";addDevice(){this.isSubmitting=!0,this.successMessage="",this.errorMessage="",this.adminService.addDevices(this.deviceObject).subscribe(t=>{console.log("Device added:",t),this.successMessage="Device added successfully!",this.isSubmitting=!1,this.deviceObject={name:"",description:"",orientation:""}},t=>{console.error("Error adding device:",t),this.errorMessage=t.error?.message||"Failed to add device. Please try again.",this.isSubmitting=!1})}navigateToList(){this.router.navigate(["/admin/Devices"])}static \u0275fac=function(e){return new(e||d)(_(w),_(O))};static \u0275cmp=P({type:d,selectors:[["app-add-devices"]],standalone:!1,decls:32,vars:10,consts:[[1,"container","device-form-container"],[1,"form-card"],[1,"back-button","mb-5"],[1,"btn-back",3,"click"],[1,"fas","fa-arrow-left","me-2"],[1,"form-title"],[1,"fas","fa-tablet-alt","me-2"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"ngSubmit"],[1,"form-group"],["for","name"],[1,"fas","fa-tag","me-2"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],[1,"fas","fa-align-left","me-2"],["id","description","name","description","rows","3","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","orientation"],[1,"fas","fa-arrows-alt","me-2"],["id","orientation","name","orientation","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","submit",1,"btn-submit",3,"disabled"],["class","spinner",4,"ngIf"],["class","fas fa-paper-plane me-2",4,"ngIf"],[4,"ngIf"],["role","alert",1,"alert","alert-success"],[1,"fas","fa-check-circle","me-2"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-circle","me-2"],[3,"value"],[1,"spinner"],[1,"fas","fa-paper-plane","me-2"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),g("click",function(){return o.navigateToList()}),p(4,"i",4),r(5,"Back to List "),i()(),n(6,"h2",5),p(7,"i",6),r(8,"Add Device "),i(),f(9,Mt,3,1,"div",7)(10,yt,3,1,"div",8),n(11,"form",9),g("ngSubmit",function(){return o.addDevice()}),n(12,"div",10)(13,"label",11),p(14,"i",12),r(15,"Name "),i(),n(16,"input",13),M("ngModelChange",function(c){return S(o.deviceObject.name,c)||(o.deviceObject.name=c),c}),i()(),n(17,"div",10)(18,"label",14),p(19,"i",15),r(20,"Description "),i(),n(21,"textarea",16),M("ngModelChange",function(c){return S(o.deviceObject.description,c)||(o.deviceObject.description=c),c}),i()(),n(22,"div",10)(23,"label",17),p(24,"i",18),r(25,"Orientation "),i(),n(26,"select",19),M("ngModelChange",function(c){return S(o.deviceObject.orientation,c)||(o.deviceObject.orientation=c),c}),f(27,Pt,3,4,"option",20),i()(),n(28,"button",21),f(29,Ot,1,0,"span",22)(30,wt,1,0,"i",23)(31,kt,2,0,"span",24),i()()()()),e&2&&(s(9),l("ngIf",o.successMessage),s(),l("ngIf",o.errorMessage),s(6),C("ngModel",o.deviceObject.name),s(5),C("ngModel",o.deviceObject.description),s(5),C("ngModel",o.deviceObject.orientation),s(),l("ngForOf",o.orientations),s(),l("disabled",o.isSubmitting),s(),l("ngIf",o.isSubmitting),s(),l("ngIf",!o.isSubmitting),s(),l("ngIf",!o.isSubmitting))},dependencies:[A,I,L,R,z,D,F,T,N,q,j,B,U],styles:[".device-form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;color:#fff}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;box-shadow:0 10px 30px #0003;padding:40px 30px;width:100%;max-width:500px;text-align:center;transition:transform .3s ease,box-shadow .3s ease}.form-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 15px 35px #0000004d}.form-title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#333;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:10px}.form-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#007bff}.alert[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;padding:10px 15px;font-size:1rem;text-align:center}.alert-success[_ngcontent-%COMP%]{background-color:#e6f7e6;color:#28a745;border:1px solid #28a745}.alert-danger[_ngcontent-%COMP%]{background-color:#fdeaea;color:#dc3545;border:1px solid #dc3545}.form-group[_ngcontent-%COMP%]{margin-bottom:20px;text-align:left}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:1rem;font-weight:600;margin-bottom:5px;color:#555}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:2px solid #ddd;border-radius:10px;font-size:1rem;transition:border-color .3s ease,box-shadow .3s ease;background:#f9f9f9}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 8px #007bff4d;background:#fff}.btn-submit[_ngcontent-%COMP%]{background:#007bff;color:#fff;border:none;padding:12px 20px;border-radius:25px;font-size:1rem;font-weight:600;text-transform:uppercase;cursor:pointer;transition:all .3s ease;box-shadow:0 5px 15px #007bff66}.btn-submit[_ngcontent-%COMP%]:hover{background:#0056b3;box-shadow:0 10px 25px #0056b380;transform:translateY(-2px)}.btn-submit[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 3px 8px #007bff4d}.btn-submit[_ngcontent-%COMP%]:disabled{background:#ccc;color:#999;cursor:not-allowed;box-shadow:none}.spinner[_ngcontent-%COMP%]{width:18px;height:18px;border:3px solid #f3f3f3;border-top:3px solid #007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.back-button[_ngcontent-%COMP%]{margin-bottom:20px;text-align:left}.btn-back[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:10px 20px;border-radius:50px;font-size:1rem;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 15px #6c757d66}.btn-back[_ngcontent-%COMP%]:hover{background:#5a6268;transform:translateY(-2px);box-shadow:0 10px 20px #5a626880}.btn-back[_ngcontent-%COMP%]:active{transform:translateY(2px)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:20px 30px}.btn-submit[_ngcontent-%COMP%], .btn-back[_ngcontent-%COMP%]{padding:10px 15px}}"]})};var At=(d,t)=>({"fa-solid fa-link text-success fs-5":d,"fas fa-times-circle text-danger fs-5":t}),It=(d,t)=>({"text-success":d,"text-danger":t});function Et(d,t){if(d&1){let e=y();n(0,"li")(1,"button",34),g("click",function(){u(e);let a=m().$implicit,c=m();return v(c.unpairageDevice(a.deviceId))}),p(2,"i",36),r(3," Unpair "),i()()}}function Dt(d,t){if(d&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),r(10),E(11,"titlecase"),i(),n(12,"td")(13,"div",23),p(14,"i",24),n(15,"span",25),r(16),i()()(),n(17,"td")(18,"div",26)(19,"button",27),r(20," Actions "),i(),n(21,"ul",28)(22,"li")(23,"button",29),g("click",function(){let a=u(e).$implicit,c=m();return v(c.openEditModal(a))}),p(24,"i",30),r(25," Edit "),i()(),n(26,"li")(27,"button",29),g("click",function(){let a=u(e).$implicit,c=m();return v(c.confirmArchive(a._id))}),p(28,"i",31),r(29," Archive "),i()(),n(30,"li")(31,"button",29),g("click",function(){let a=u(e).$implicit,c=m();return v(c.openScheduleModal(a))}),p(32,"i",32),r(33," Schedule "),i()(),f(34,Et,4,0,"li",33),n(35,"li")(36,"button",34),g("click",function(){let a=u(e).$implicit,c=m();return v(c.deleteDevice(a._id))}),p(37,"i",35),r(38," Delete "),i()()()()()()}if(d&2){let e=t.$implicit,o=t.index,a=m();s(2),x((a.currentPage-1)*a.itemsPerPage+o+1),s(2),x(e.deviceId),s(2),x(e.name),s(2),x(e.description),s(2),x(V(11,13,e.orientation)),s(4),l("ngClass",K(15,At,e.isPaired===!0,e.isPaired===!1))("title",e.isPaired?"Device Paired":"Device Not Paired"),s(),l("ngClass",K(18,It,e.isPaired===!0,e.isPaired===!1)),s(),x(e.isPaired?"Paired":"Not Paired"),s(3),Ve("id","actionsDropdown",e._id,""),s(2),De("aria-labelledby","actionsDropdown"+e._id),s(13),l("ngIf",e.isPaired===!0)}}function Tt(d,t){d&1&&(n(0,"div",48)(1,"p"),r(2,"No advertisements available to schedule."),i()())}function Vt(d,t){if(d&1&&p(0,"video",59),d&2){let e=m().$implicit;l("src",e.videoUrl,J)}}function Nt(d,t){if(d&1){let e=y();n(0,"div",51)(1,"div",52),f(2,Vt,1,1,"video",53),n(3,"div",54)(4,"div",55)(5,"input",56,0),g("change",function(){let a=u(e).$implicit,c=ie(6),b=m(3);return v(b.toggleAdSelection(a._id,c.checked))}),i(),n(7,"label",57),r(8),i()(),n(9,"p",58),r(10),i()()()()}if(d&2){let e=t.$implicit;s(2),l("ngIf",e.videoUrl),s(3),l("id","checkbox-"+e._id)("value",e._id),s(2),l("for","checkbox-"+e._id),s(),h(" ",e.name," "),s(),Te("title",e.description),s(),h(" ",e.description," ")}}function jt(d,t){if(d&1&&(n(0,"div",49),f(1,Nt,11,7,"div",50),i()),d&2){let e=m(2);s(),l("ngForOf",e.ads)}}function Lt(d,t){if(d&1){let e=y();n(0,"div",37)(1,"div",38)(2,"div",39)(3,"div",40)(4,"h5",41),r(5,"Schedule Ads"),i(),n(6,"button",42),g("click",function(){u(e);let a=m();return v(a.isScheduleModalOpen=!1)}),i()(),n(7,"div",43),f(8,Tt,3,0,"div",44)(9,jt,2,1,"div",45),i(),n(10,"div",46)(11,"button",47),g("click",function(){u(e);let a=m();return v(a.navigateToSchedule())}),r(12," Schedule "),i()()()()()}if(d&2){let e=m();s(8),l("ngIf",e.ads.length===0),s(),l("ngIf",e.ads.length>0)}}function Ft(d,t){if(d&1){let e=y();n(0,"div",37)(1,"div",60)(2,"div",39)(3,"div",61)(4,"h5",41),r(5,"Confirm Archive"),i(),n(6,"button",42),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),i()(),n(7,"div",43)(8,"p"),r(9,"Are you sure you want to archive this device?"),i()(),n(10,"div",46)(11,"button",62),g("click",function(){u(e);let a=m();return v(a.closeConfirmDialog())}),r(12," Cancel "),i(),n(13,"button",63),g("click",function(){u(e);let a=m();return v(a.archiveDevice())}),r(14," Archive "),i()()()()()}}function Rt(d,t){if(d&1){let e=y();n(0,"div",37)(1,"div",60)(2,"div",39)(3,"div",61)(4,"h5",41),r(5,"Edit Device"),i(),n(6,"button",42),g("click",function(){u(e);let a=m();return v(a.closeEditModal())}),i()(),n(7,"div",43)(8,"form",null,1)(10,"div",64)(11,"label",65),r(12,"Device ID"),i(),n(13,"input",66),M("ngModelChange",function(a){u(e);let c=m();return S(c.editDeviceObject.deviceId,a)||(c.editDeviceObject.deviceId=a),v(a)}),i()(),n(14,"div",64)(15,"label",67),r(16,"Name"),i(),n(17,"input",68),M("ngModelChange",function(a){u(e);let c=m();return S(c.editDeviceObject.name,a)||(c.editDeviceObject.name=a),v(a)}),i()(),n(18,"div",64)(19,"label",69),r(20,"Description"),i(),n(21,"textarea",70),M("ngModelChange",function(a){u(e);let c=m();return S(c.editDeviceObject.description,a)||(c.editDeviceObject.description=a),v(a)}),i()(),n(22,"div",64)(23,"label",71),r(24,"Orientation"),i(),n(25,"select",72),M("ngModelChange",function(a){u(e);let c=m();return S(c.editDeviceObject.orientation,a)||(c.editDeviceObject.orientation=a),v(a)}),n(26,"option",73),r(27,"Landscape"),i(),n(28,"option",74),r(29,"Portrait"),i()()()()(),n(30,"div",46)(31,"button",62),g("click",function(){u(e);let a=m();return v(a.closeEditModal())}),r(32," Cancel "),i(),n(33,"button",75),g("click",function(){u(e);let a=m();return v(a.updateDevice())}),r(34," Save Changes "),i()()()()()}if(d&2){let e=ie(9),o=m();s(13),C("ngModel",o.editDeviceObject.deviceId),s(4),C("ngModel",o.editDeviceObject.name),s(4),C("ngModel",o.editDeviceObject.description),s(4),C("ngModel",o.editDeviceObject.orientation),s(8),l("disabled",!e.form.valid)}}var ve=class d{constructor(t,e){this.adminService=t;this.router=e}devices=[];filteredDevices=[];ads=[];searchTerm="";currentPage=1;itemsPerPage=5;totalPages=0;errorMessage="";editDeviceObject={};isEditModalOpen=!1;isConfirmDialogOpen=!1;archivingDeviceId="";selectedDevice=null;selectedAds=[];isScheduleModalOpen=!1;ngOnInit(){this.loadDevices()}loadDevices(){this.adminService.getDevices().subscribe(t=>{t&&Array.isArray(t.data)?(this.devices=t.data.filter(e=>e.isDeleted===!1),this.filteredDevices=[...this.devices],this.calculatePagination()):console.error("Unexpected response format:",t)},t=>{this.errorMessage=t.error?.message||"Failed to load devices. Please try again."})}unpairageDevice(t){this.adminService.isPaired(t).subscribe(e=>{this.loadDevices()})}loadAds(){this.adminService.getAds().subscribe(t=>{this.ads=(t.data||[]).filter(e=>e.isDeleted===!1)},t=>{this.errorMessage=t.error?.message||"Failed to load advertisements."})}onSearch(){let t=this.searchTerm.toLowerCase();this.filteredDevices=this.devices.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.orientation.toLowerCase().includes(t)),this.calculatePagination()}calculatePagination(){this.totalPages=Math.ceil(this.filteredDevices.length/this.itemsPerPage),this.currentPage=Math.min(this.currentPage,this.totalPages||1)}getPaginatedDevices(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredDevices.slice(t,e)}previousPage(){this.currentPage>1&&this.currentPage--}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}openEditModal(t){this.editDeviceObject=k({},t),this.isEditModalOpen=!0}closeEditModal(){this.isEditModalOpen=!1}updateDevice(){this.adminService.updateDevices(this.editDeviceObject._id,this.editDeviceObject).subscribe(()=>{this.loadDevices(),this.isEditModalOpen=!1},t=>{this.errorMessage=t.error?.message||"Failed to update device. Please try again."})}confirmArchive(t){this.archivingDeviceId=t,this.isConfirmDialogOpen=!0}archiveDevice(){this.adminService.archiveDevices(this.archivingDeviceId).subscribe(()=>{this.loadDevices(),this.isConfirmDialogOpen=!1},t=>{this.errorMessage=t.error?.message||"Failed to archive device. Please try again."})}closeConfirmDialog(){this.isConfirmDialogOpen=!1,this.archivingDeviceId=""}openScheduleModal(t){this.selectedDevice=t,this.loadAds(),this.isScheduleModalOpen=!0}navigateToSchedule(){this.isScheduleModalOpen=!1;let t={deviceId:this.selectedDevice._id,ads:this.selectedAds.join(",")};this.router.navigate(["/admin/Makeschedule"],{queryParams:t})}toggleAdSelection(t,e){e?this.selectedAds.push(t):this.selectedAds=this.selectedAds.filter(o=>o!==t)}navigateToAddDevice(){this.router.navigate(["/admin/addDevices"])}deleteDevice(t){this.adminService.deleteDeviceById(t).subscribe(()=>{this.loadDevices()},e=>{this.errorMessage=e.error?.message||"Failed to delete device."})}static \u0275fac=function(e){return new(e||d)(_(w),_(O))};static \u0275cmp=P({type:d,selectors:[["app-devices"]],standalone:!1,decls:45,vars:9,consts:[["adCheckbox",""],["editForm","ngForm"],[1,"container","py-4","ad-list-container"],[1,"list-title","text-center"],[1,"row","align-items-center","mb-3"],[1,"col-md-6","text-start"],[1,"btn","btn-primary","add-ad-btn",3,"click"],[1,"fas","fa-plus-circle","me-2"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Search devices...",1,"form-control","search-input",3,"ngModelChange","input","ngModel"],[1,"input-group-text","bg-primary","text-white"],[1,"fas","fa-search"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover","table-custom"],[1,"table-primary"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"fw-bold","text-primary"],[1,"fas","fa-chevron-right"],["class","modal fade show","style","display: block;",4,"ngIf"],[1,"d-flex","align-items-center"],[3,"ngClass","title"],[1,"ms-2","small",3,"ngClass"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-secondary","btn-sm","dropdown-toggle",3,"id"],[1,"dropdown-menu","dropdown-menu-right"],[1,"dropdown-item",3,"click"],[1,"fas","fa-edit","me-2"],[1,"fas","fa-archive","me-2"],[1,"fas","fa-tv","me-2"],[4,"ngIf"],[1,"dropdown-item","text-danger",3,"click"],[1,"fas","fa-trash-alt","me-2"],[1,"fas","fa-unlink","me-2"],[1,"modal","fade","show",2,"display","block"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header","bg-info","text-white"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-center"],[1,"row","g-3"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","h-100","shadow-sm"],["class","card-img-top rounded-top","controls","","muted","","preload","metadata",3,"src",4,"ngIf"],[1,"card-body"],[1,"form-check","mb-2"],["type","checkbox",1,"form-check-input",3,"change","id","value"],[1,"form-check-label","text-truncate",3,"for"],[1,"card-text","text-truncate",3,"title"],["controls","","muted","","preload","metadata",1,"card-img-top","rounded-top",3,"src"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-header","bg-warning","text-white"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"mb-3"],["for","deviceId",1,"form-label"],["type","text","id","deviceId","name","deviceId","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label"],["id","description","name","description","required","","rows","3",1,"form-control",3,"ngModelChange","ngModel"],["for","orientation",1,"form-label"],["id","orientation","name","orientation","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","landscape"],["value","portrait"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"]],template:function(e,o){e&1&&(n(0,"div",2)(1,"h2",3),r(2,"Devices List"),i(),n(3,"div",4)(4,"div",5)(5,"button",6),g("click",function(){return o.navigateToAddDevice()}),p(6,"i",7),r(7," Add Device "),i()(),n(8,"div",8)(9,"div",9)(10,"input",10),M("ngModelChange",function(c){return S(o.searchTerm,c)||(o.searchTerm=c),c}),g("input",function(){return o.onSearch()}),i(),n(11,"span",11),p(12,"i",12),i()()()(),n(13,"div",13)(14,"table",14)(15,"thead",15)(16,"tr")(17,"th"),r(18,"#"),i(),n(19,"th"),r(20,"Device ID"),i(),n(21,"th"),r(22,"Name"),i(),n(23,"th"),r(24,"Description"),i(),n(25,"th"),r(26,"Orientation"),i(),n(27,"th"),r(28,"Status"),i(),n(29,"th"),r(30,"Actions"),i()()(),n(31,"tbody"),f(32,Dt,39,21,"tr",16),i()()(),n(33,"div",17)(34,"button",18),g("click",function(){return o.previousPage()}),p(35,"i",19),r(36," Previous "),i(),n(37,"span",20),r(38),i(),n(39,"button",18),g("click",function(){return o.nextPage()}),r(40," Next "),p(41,"i",21),i()(),f(42,Lt,13,2,"div",22)(43,Ft,15,0,"div",22)(44,Rt,35,5,"div",22),i()),e&2&&(s(10),C("ngModel",o.searchTerm),s(22),l("ngForOf",o.getPaginatedDevices()),s(2),l("disabled",o.currentPage===1),s(4),G(" Page ",o.currentPage," of ",o.totalPages," "),s(),l("disabled",o.currentPage===o.totalPages),s(3),l("ngIf",o.isScheduleModalOpen),s(),l("ngIf",o.isConfirmDialogOpen),s(),l("ngIf",o.isEditModalOpen))},dependencies:[re,A,I,L,R,z,D,F,T,N,q,j,B,U],styles:[".ad-list-container[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background:#fff;border-radius:15px;box-shadow:0 8px 20px #0003}.list-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;text-align:center;margin-bottom:20px;color:#333}.input-group[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-right:none}.input-group-text[_ngcontent-%COMP%]{border-left:none}.table-custom[_ngcontent-%COMP%]{border-radius:15px;overflow:hidden;box-shadow:0 8px 20px #0000001a}.table-custom[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-custom[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;padding:15px;vertical-align:middle}.table-custom[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.table-custom[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.pagination-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;font-size:1rem;border-radius:25px}.pagination-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:700}.modal-content[_ngcontent-%COMP%]{border-radius:15px;box-shadow:0 8px 20px #0003}.modal-header[_ngcontent-%COMP%]{border-bottom:none}.modal-footer[_ngcontent-%COMP%]{border-top:none}.btn-sm[_ngcontent-%COMP%]{font-size:.875rem;padding:6px 12px}.card[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;transition:transform .3s ease,box-shadow .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 6px 15px #0003}.card-img-top[_ngcontent-%COMP%]{height:140px;object-fit:cover}.card-body[_ngcontent-%COMP%]{padding:12px}.card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin-bottom:.5rem}.card-text[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.btn-sm[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem 1rem}.dropdown-menu[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;z-index:1050;top:auto;bottom:100%;transform:translateY(-5px)}.dropdown[_ngcontent-%COMP%]{position:relative}@media (max-width: 768px){.card-img-top[_ngcontent-%COMP%]{height:120px}.card-title[_ngcontent-%COMP%]{font-size:.9rem}.card-text[_ngcontent-%COMP%]{font-size:.8rem}}.table-responsive[_ngcontent-%COMP%]{position:relative;overflow:visible}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;z-index:1055;top:100%;left:auto;right:0;transform:translateY(5px);box-shadow:0 8px 15px #0003;width:max-content;min-width:12rem}.table-custom[_ngcontent-%COMP%]{overflow:visible}.dropdown-menu[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.ad-list-container[_ngcontent-%COMP%]{overflow:visible;position:relative}"]})};var zt=()=>["portrait","landscape"];function Wt(d,t){if(d&1&&(n(0,"div",43),r(1),i()),d&2){let e=m();s(),h(" ",e.errorMessage," ")}}function Ut(d,t){if(d&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),r(10),E(11,"titlecase"),i(),n(12,"td")(13,"button",44),g("click",function(){let a=u(e).$implicit,c=m();return v(c.confirmArchive(a._id))}),p(14,"i",45),r(15," UnArchive "),i()()()}if(d&2){let e=t.$implicit,o=t.index,a=m();s(2),x((a.currentPage-1)*a.itemsPerPage+o+1),s(2),x(e.deviceId),s(2),x(e.name),s(2),x(e.description),s(2),x(V(11,5,e.orientation))}}function Bt(d,t){if(d&1&&(n(0,"option",46),r(1),E(2,"titlecase"),i()),d&2){let e=t.$implicit;l("value",e),s(),h(" ",V(2,2,e)," ")}}var fe=class d{constructor(t,e){this.adminService=t;this.router=e}devices=[];filteredDevices=[];searchTerm="";currentPage=1;itemsPerPage=5;totalPages=0;errorMessage="";editDeviceObject={};isEditModalOpen=!1;isConfirmDialogOpen=!1;archivingDeviceId="";ngOnInit(){this.loadDevices()}loadDevices(){this.adminService.getDevices().subscribe(t=>{if(console.log("API Response  un:",t.data),t&&Array.isArray(t.data))this.devices=t.data.filter(e=>e.isDeleted===!0),this.filteredDevices=[...this.devices],this.calculatePagination();else throw console.error("Unexpected response format:",t),new TypeError("Unexpected response format. Expected an object with a data array.")},t=>{console.error("Error fetching devices:",t),this.errorMessage=t.error?.message||"Failed to load devices. Please try again."})}onSearch(){let t=this.searchTerm.toLowerCase();this.filteredDevices=this.devices.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.orientation.toLowerCase().includes(t)),this.calculatePagination()}calculatePagination(){this.totalPages=Math.ceil(this.filteredDevices.length/this.itemsPerPage),this.currentPage=Math.min(this.currentPage,this.totalPages||1)}getPaginatedDevices(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredDevices.slice(t,e)}previousPage(){this.currentPage>1&&this.currentPage--}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}openEditModal(t){this.editDeviceObject=k({},t),this.isEditModalOpen=!0}closeEditModal(){this.isEditModalOpen=!1}updateDevice(){this.adminService.updateDevices(this.editDeviceObject._id,this.editDeviceObject).subscribe(()=>{this.loadDevices(),this.isEditModalOpen=!1},t=>{console.error("Error updating device:",t),this.errorMessage=t.error?.message||"Failed to update device. Please try again."})}confirmArchive(t){this.archivingDeviceId=t,this.isConfirmDialogOpen=!0}unarchiveDevices(){this.adminService.unarchiveDevices(this.archivingDeviceId).subscribe(()=>{this.loadDevices(),this.isConfirmDialogOpen=!1},t=>{console.error("Error archiving device:",t),this.errorMessage=t.error?.message||"Failed to archive device. Please try again."})}closeConfirmDialog(){this.isConfirmDialogOpen=!1,this.archivingDeviceId=""}navigateToAddDevice(){this.router.navigate(["/admin/addDevices"])}static \u0275fac=function(e){return new(e||d)(_(w),_(O))};static \u0275cmp=P({type:d,selectors:[["app-archive-dev"]],standalone:!1,decls:79,vars:12,consts:[[1,"container","py-4","ad-list-container"],[1,"list-title","text-center"],[1,"row","align-items-center","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Search devices...",1,"form-control","search-input",3,"ngModelChange","input","ngModel"],[1,"input-group-text","bg-primary","text-white"],[1,"fas","fa-search"],["class","alert alert-danger",4,"ngIf"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover"],[1,"table-primary"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"fw-bold","text-primary"],[1,"fas","fa-chevron-right"],["id","editDeviceModal","tabindex","-1","aria-labelledby","editDeviceModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],["id","editDeviceModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"ngSubmit"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label"],["id","description","name","description","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","orientation",1,"form-label"],["id","orientation","name","orientation","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","confirmArchiveModal","tabindex","-1","aria-labelledby","confirmArchiveModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-header","bg-success","text-white"],["id","confirmArchiveModalLabel",1,"modal-title"],[1,"fw-bold","text-danger"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"alert","alert-danger"],["data-bs-toggle","modal","data-bs-target","#confirmArchiveModal",1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-archive"],[3,"value"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h2",1),r(2,"Archived Devices List"),i(),n(3,"div",2)(4,"div",3)(5,"div",4)(6,"input",5),M("ngModelChange",function(c){return S(o.searchTerm,c)||(o.searchTerm=c),c}),g("input",function(){return o.onSearch()}),i(),n(7,"span",6),p(8,"i",7),i()()()(),f(9,Wt,2,1,"div",8),n(10,"div",9)(11,"table",10)(12,"thead",11)(13,"tr")(14,"th"),r(15,"#"),i(),n(16,"th"),r(17,"Device ID"),i(),n(18,"th"),r(19,"Name"),i(),n(20,"th"),r(21,"Description"),i(),n(22,"th"),r(23,"Orientation"),i(),n(24,"th"),r(25,"Actions"),i()()(),n(26,"tbody"),f(27,Ut,16,7,"tr",12),i()()(),n(28,"div",13)(29,"button",14),g("click",function(){return o.previousPage()}),p(30,"i",15),r(31," Previous "),i(),n(32,"span",16),r(33),i(),n(34,"button",14),g("click",function(){return o.nextPage()}),r(35," Next "),p(36,"i",17),i()(),n(37,"div",18)(38,"div",19)(39,"div",20)(40,"div",21)(41,"h5",22),r(42,"Edit Device"),i(),p(43,"button",23),i(),n(44,"div",24)(45,"form",25),g("ngSubmit",function(){return o.updateDevice()}),n(46,"div",26)(47,"label",27),r(48,"Name"),i(),n(49,"input",28),M("ngModelChange",function(c){return S(o.editDeviceObject.name,c)||(o.editDeviceObject.name=c),c}),i()(),n(50,"div",26)(51,"label",29),r(52,"Description"),i(),n(53,"textarea",30),M("ngModelChange",function(c){return S(o.editDeviceObject.description,c)||(o.editDeviceObject.description=c),c}),i()(),n(54,"div",26)(55,"label",31),r(56,"Orientation"),i(),n(57,"select",32),M("ngModelChange",function(c){return S(o.editDeviceObject.orientation,c)||(o.editDeviceObject.orientation=c),c}),f(58,Bt,3,4,"option",33),i()(),n(59,"div",34)(60,"button",35),r(61,"Save Changes"),i(),n(62,"button",36),r(63," Cancel "),i()()()()()()(),n(64,"div",37)(65,"div",19)(66,"div",20)(67,"div",38)(68,"h5",39),r(69," Confirm UnArchive "),i(),p(70,"button",23),i(),n(71,"div",24)(72,"p",40),r(73,"Are you sure you want to unarchive this device?"),i()(),n(74,"div",34)(75,"button",41),g("click",function(){return o.unarchiveDevices()}),r(76," Yes "),i(),n(77,"button",42),r(78," No "),i()()()()()()),e&2&&(s(6),C("ngModel",o.searchTerm),s(3),l("ngIf",o.errorMessage),s(18),l("ngForOf",o.getPaginatedDevices()),s(2),l("disabled",o.currentPage===1),s(4),G(" Page ",o.currentPage," of ",o.totalPages," "),s(),l("disabled",o.currentPage===o.totalPages),s(15),C("ngModel",o.editDeviceObject.name),s(4),C("ngModel",o.editDeviceObject.description),s(4),C("ngModel",o.editDeviceObject.orientation),s(),l("ngForOf",Ne(11,zt)))},dependencies:[A,I,L,R,z,D,F,T,N,q,j,B,U],encapsulation:2})};var te=class d{constructor(t){this.socket=t;this.setupConnectionListeners()}configureSocket(t){this.socket.ioSocket.io.opts=k(k({},this.socket.ioSocket.io.opts),t.options),t.url&&(this.socket.ioSocket.io.uri=t.url),console.log("Socket configured with URL:",t.url)}setupConnectionListeners(){this.socket.on("connect",()=>console.log("Connected to socket server")),this.socket.on("disconnect",t=>console.error("Disconnected:",t)),this.socket.on("connect_error",t=>console.error("Connect error:",t)),this.socket.on("reconnect",t=>console.log("Reconnected:",t)),this.socket.on("reconnect_attempt",t=>console.log("Reconnect attempt:",t)),this.socket.on("reconnect_error",t=>console.error("Reconnect error:",t)),this.socket.on("reconnect_failed",()=>console.error("Reconnect failed"))}isConnected(){return this.socket.ioSocket.connected}listen(t){return this.socket.fromEvent(t)}emit(t,e){this.socket.emit(t,e)}joinRoom(t){this.socket.emit("join",t),console.log("Joined room:",t)}leaveRoom(t){this.socket.emit("leave",t),console.log("Left room:",t)}getConnectionStatus(){return new Ce(t=>(this.socket.on("connect",()=>t.next(!0)),this.socket.on("disconnect",()=>t.next(!1)),t.next(this.isConnected()),()=>{this.socket.off("connect"),this.socket.off("disconnect")}))}disconnect(){this.socket.disconnect(),console.log("Socket disconnected")}connect(){this.socket.connect(),console.log("Socket connected")}onConnect(){return new Ce(t=>{this.isConnected()?(t.next(),t.complete()):this.socket.on("connect",()=>{t.next(),t.complete()})})}static \u0275fac=function(e){return new(e||d)(Ae(Qe))};static \u0275prov=ke({token:d,factory:d.\u0275fac,providedIn:"root"})};function qt(d,t){if(d&1&&(n(0,"div",6),r(1),i()),d&2){let e=m();s(),h(" ",e.success," ")}}function Yt(d,t){d&1&&(n(0,"div",7)(1,"div",8)(2,"span",9),r(3,"Loading..."),i()()())}function Gt(d,t){if(d&1&&(n(0,"div",34)(1,"div",16)(2,"h5",17),r(3),i(),n(4,"p",35),r(5),i(),n(6,"p",35),r(7),i()()()),d&2){let e=m(2);s(3),x(e.device.name),s(2),h("ID: ",e.device._id,""),s(2),h("Location: ",e.device.location||"Not specified","")}}function Zt(d,t){if(d&1&&(n(0,"div",36)(1,"h5",37),r(2),i(),n(3,"p",37),r(4),i()()),d&2){let e=t.$implicit;s(2),x(e.name),s(2),h("Duration: ",e.duration," seconds")}}function Ht(d,t){if(d&1){let e=y();n(0,"form",10),g("ngSubmit",function(){u(e);let a=m();return v(a.createSchedule())}),n(1,"div",11)(2,"h4"),r(3,"Device Information"),i(),f(4,Gt,8,3,"div",12),i(),n(5,"div",11)(6,"h4"),r(7,"Selected Advertisements"),i(),n(8,"div",13),f(9,Zt,5,2,"div",14),i()(),n(10,"div",15)(11,"div",16)(12,"h4",17),r(13,"Schedule Settings"),i(),n(14,"div",11)(15,"label",18),r(16,"Start Time"),i(),n(17,"input",19),M("ngModelChange",function(a){u(e);let c=m();return S(c.startTime,a)||(c.startTime=a),v(a)}),i()(),n(18,"div",11)(19,"label",20),r(20,"Play Time (minutes)"),i(),n(21,"input",21),M("ngModelChange",function(a){u(e);let c=m();return S(c.playTime,a)||(c.playTime=a),v(a)}),i()(),n(22,"div",11)(23,"label",22),r(24,"Repeat"),i(),n(25,"select",23),M("ngModelChange",function(a){u(e);let c=m();return S(c.repeat,a)||(c.repeat=a),v(a)}),n(26,"option",24),r(27,"Once"),i(),n(28,"option",25),r(29,"Daily"),i(),n(30,"option",26),r(31,"Weekly"),i()()(),n(32,"div",11)(33,"label",27),r(34,"Play Mode"),i(),n(35,"select",28),M("ngModelChange",function(a){u(e);let c=m();return S(c.playMode,a)||(c.playMode=a),v(a)}),n(36,"option",29),r(37,"Loop"),i(),n(38,"option",30),r(39,"Sequence"),i(),n(40,"option",31),r(41,"Random"),i()()()()(),n(42,"div",32)(43,"button",33),r(44),i()()()}if(d&2){let e=m();s(4),l("ngIf",e.device),s(5),l("ngForOf",e.ads),s(8),C("ngModel",e.startTime),s(4),C("ngModel",e.playTime),s(4),C("ngModel",e.repeat),s(10),C("ngModel",e.playMode),s(9),h(" ",e.loading?"Creating Schedule...":"Create Schedule"," ")}}var he=class d{constructor(t,e,o,a,c){this.route=t;this.router=e;this.adminService=o;this.socketService=a;this.platformId=c}deviceId="";selectedAds=[];device=null;ads=[];loading=!1;error=null;success=null;startTime=new Date;playTime=60;repeat="once";playMode="loop";subscriptions=[];ngOnInit(){ze(this.platformId)&&this.route.queryParams.subscribe(t=>{this.deviceId=t.deviceId,this.selectedAds=t.ads?t.ads.split(","):[],this.deviceId&&(this.loadDeviceAndAds(),this.socketService.joinRoom(this.deviceId))}),this.socketService.getConnectionStatus().pipe(Me(3e4),ye(t=>(this.error="Request timed out",this.loading=!1,Se(null)))).subscribe(t=>{t||(this.error="Disconnected from server")}),this.socketService.listen("scheduleError").subscribe(t=>{this.error=t.message||"Error creating schedule",this.loading=!1})}loadDeviceAndAds(){this.loading=!0,this.adminService.getDevicesById(this.deviceId).pipe(Me(3e4),ye(e=>(this.error="Request timed out",this.loading=!1,Se(null)))).subscribe(e=>{this.device=e.data,this.loading=!1},e=>{this.error="Error loading device details",this.loading=!1});let t=this.selectedAds.map(e=>this.adminService.getAdsById(e).toPromise());Promise.all(t).then(e=>{this.ads=e.map(o=>o.data).filter(o=>!o.archived)}).catch(()=>{this.error="Error loading advertisement details"})}createSchedule(){let t={advertisementIds:this.selectedAds,deviceId:this.deviceId,startTime:this.startTime,playTime:this.playTime,repeat:this.repeat,playMode:this.playMode};this.socketService.emit("updateSchedule",t),this.adminService.createSchedule(t).subscribe(()=>{this.success="Schedule created successfully"},e=>{this.error=e.error?.message||"Error creating schedule"})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.socketService.leaveRoom(this.deviceId)}static \u0275fac=function(e){return new(e||d)(_(ae),_(O),_(w),_(te),_(Ee))};static \u0275cmp=P({type:d,selectors:[["app-makeschedule"]],standalone:!1,decls:8,vars:3,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-12"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],["class","text-center my-3",4,"ngIf"],["class","needs-validation","novalidate","",3,"ngSubmit",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],[1,"text-center","my-3"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["novalidate","",1,"needs-validation",3,"ngSubmit"],[1,"mb-3"],["class","card",4,"ngIf"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],["for","startTime",1,"form-label"],["type","datetime-local","id","startTime","name","startTime","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","playTime",1,"form-label"],["type","number","id","playTime","name","playTime","min","1","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","repeat",1,"form-label"],["id","repeat","name","repeat","required","",1,"form-select",3,"ngModelChange","ngModel"],["value","once"],["value","daily"],["value","weekly"],["for","playMode",1,"form-label"],["id","playMode","name","playMode","required","",1,"form-select",3,"ngModelChange","ngModel"],["value","loop"],["value","sequence"],["value","random"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],[1,"card"],[1,"card-text"],[1,"list-group-item"],[1,"mb-1"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),r(4,"Create Schedule"),i(),f(5,qt,2,1,"div",3)(6,Yt,4,0,"div",4)(7,Ht,45,7,"form",5),i()()()),e&2&&(s(5),l("ngIf",o.success),s(),l("ngIf",o.loading),s(),l("ngIf",!o.loading))},dependencies:[A,I,L,R,z,D,se,F,T,N,q,Ze,j,B],styles:[".card[_ngcontent-%COMP%]{transition:transform .3s ease-in-out,box-shadow .3s ease-in-out;border-radius:8px}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #0000001a}.video-container[_ngcontent-%COMP%]{max-width:100%;overflow:hidden}.video-thumbnail[_ngcontent-%COMP%]{width:100%;max-height:250px;object-fit:cover}.form-container[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:20px;border-radius:10px;box-shadow:0 4px 12px #0000001a}.form-container[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:600}.form-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{border-radius:8px;box-shadow:inset 0 1px 3px #0000001a}.form-container[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{font-weight:700;border-radius:8px}.selected-ads[_ngcontent-%COMP%]   .ad-card[_ngcontent-%COMP%]{display:inline-block;width:100%;max-width:350px;margin-right:20px;margin-bottom:20px}.selected-ads[_ngcontent-%COMP%]   .ad-card[_ngcontent-%COMP%]:last-child{margin-right:0}h2[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{font-weight:700;color:#333}.card-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:500}.card-text[_ngcontent-%COMP%]{font-size:.9rem;color:#555}.text-primary[_ngcontent-%COMP%]{color:#007bff}.mb-4[_ngcontent-%COMP%], .mb-5[_ngcontent-%COMP%]{margin-bottom:30px!important}.mt-5[_ngcontent-%COMP%]{margin-top:50px}.w-100[_ngcontent-%COMP%]{width:100%!important}"]})};var we=(d,t)=>({"dot-green":d,"dot-red":t}),Jt=(d,t)=>({"text-success":d,"text-danger":t}),Kt=(d,t,e)=>({"dot-green":d,"dot-blinking":t,"dot-red":e});function Qt(d,t){if(d&1&&(n(0,"span",39),p(1,"i",31),r(2),i()),d&2){let e=m().$implicit;s(),l("ngClass",je(2,Kt,(e.instantData==null?null:e.instantData.titleVideo)&&e.appState==="foreground"&&e.TVstate==="on"&&e.SystemState!=="shutting_down",!(e.instantData!=null&&e.instantData.titleVideo)&&e.appState==="foreground"&&e.TVstate==="on"&&e.SystemState!=="shutting_down",e.appState!=="foreground"||e.TVstate==="off"||e.SystemState==="shutting_down")),s(),h(" N\xB0 ",(e.instantData==null?null:e.instantData.index)||""," ")}}function Xt(d,t){d&1&&(n(0,"span",39),p(1,"i",40),r(2," N/A "),i())}function $t(d,t){if(d&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td",28)(8,"table",29)(9,"thead")(10,"tr")(11,"th"),r(12,"System"),i(),n(13,"th"),r(14,"Screen"),i(),n(15,"th"),r(16,"App"),i(),n(17,"th"),r(18,"Playlist"),i(),n(19,"th"),r(20,"Views"),i()()(),n(21,"tbody")(22,"tr")(23,"td")(24,"span",30),p(25,"i",31),r(26," System "),i()(),n(27,"td")(28,"span",32),p(29,"i",31),r(30," Screen "),i()(),n(31,"td")(32,"span",33),p(33,"i",31),r(34," App "),i()(),n(35,"td"),f(36,Qt,3,6,"span",34)(37,Xt,3,0,"span",34),i(),n(38,"td",35)(39,"span",36),r(40),i()()()()()(),n(41,"td")(42,"button",37),g("click",function(){let a=u(e).$implicit,c=m();return v(c.viewSchedule(a._id))}),r(43," View "),i(),n(44,"button",38),g("click",function(){let a=u(e).$implicit,c=m();return v(c.deleteSchedule(a._id))}),r(45," Delete "),i()()()}if(d&2){let e=t.$implicit,o=m();s(2),x(e.deviceId.name),s(2),h("",e.advertisementIds.length," ads"),s(2),x((e.instantData==null?null:e.instantData.titleVideo)||"Waiting for data..."),s(19),l("ngClass",K(10,we,e.SystemState!=="shutting_down"&&e.SystemState!=="inactive",e.SystemState==="shutting_down"||e.SystemState==="inactive")),s(4),l("ngClass",K(13,we,e.TVstate==="on"&&e.SystemState!=="shutting_down",e.TVstate==="off"||e.SystemState==="shutting_down")),s(4),l("ngClass",K(16,we,e.appState==="foreground"&&e.TVstate==="on"&&e.SystemState!=="shutting_down",e.appState!=="foreground"||e.TVstate==="off"||e.SystemState==="shutting_down")),s(3),l("ngIf",e.instantData),s(),l("ngIf",!e.instantData),s(2),l("ngClass",K(19,Jt,o.getDeviceStatus(e)==="All Good",o.getDeviceStatus(e)!=="All Good")),s(),h(" ",o.getDeviceStatus(e)," ")}}function ei(d,t){d&1&&(n(0,"div",41)(1,"div",42)(2,"span",43),r(3,"Loading..."),i()()())}function ti(d,t){d&1&&(n(0,"div",41)(1,"p"),r(2,"No schedules found."),i()())}function ii(d,t){if(d&1&&(n(0,"div",44),r(1),i()),d&2){let e=m();s(),h(" ",e.error," ")}}var et=3e5,ni=6e5;var _e=class d{constructor(t,e,o,a,c){this.adminService=t;this.router=e;this.socketService=o;this.cdr=a;this.ngZone=c}schedules=[];paginatedSchedules=[];loading=!1;error="";pageIndex=0;pageSize=5;totalPages=0;subscriptions=[];mismatchTimeouts={};sameIndexTimeouts={};lastIndices={};deviceLogs={};inactivityTimers={};deviceStates={};VariableTitleVd="Your Text Here";blockAppState={};blockAds={};intervalId;ngOnInit(){this.loadSchedules(),this.updatePagination(),this.schedules.forEach(t=>{let e=this.getLocalStorageState(t.deviceId.deviceId);e.isAppStateTimePassed&&e.NoResponse?t.appState="inactive":t.appState=e.LastAppState,e.NoResponse?t.TVstate="off":t.TVstate=e.LastTVstate}),this.socketService.onConnect().subscribe(()=>{console.log("Socket is connected, setting up subscriptions"),this.subscribeToDeviceUpdates(),this.StateApp(),this.oneRefresh(),this.TVStateWeb(),this.SystemStateWeb()})}oneRefresh(){this.socketService.listen("returnStateWeb").subscribe(t=>{console.log("Received ReturnStateWeb event:",t),this.inactivityTimers[t.deviceId]&&clearTimeout(this.inactivityTimers[t.deviceId]),this.schedules=this.schedules.map(e=>{if(e.deviceId.deviceId===t.deviceId){let o=this.getLocalStorageState(t.deviceId);return Y(k({},e),{appState:o.NoResponse?"inactive":t.lastAppState,TVstate:o.NoResponse?"inactive":t.lastTvState,SystemState:t.lastSystemState})}return e}),this.cdr.detectChanges(),this.ngZone.runOutsideAngular(()=>{this.inactivityTimers[t.deviceId]=setTimeout(()=>{console.log(`No update received for device ${t.deviceId} in 5 seconds, setting states to inactive`),this.ngZone.run(()=>{this.schedules=this.schedules.map(e=>e.deviceId.deviceId===t.deviceId?(this.updateLocalStorageState(t.deviceId,"inactive","inactive",!0,!0,0),Y(k({},e),{appState:"inactive",TVstate:"inactive"})):e),this.updatePagination(),this.cdr.detectChanges()})},et)}),this.updatePagination(),this.cdr.detectChanges()})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),Object.values(this.mismatchTimeouts).forEach(t=>clearTimeout(t)),Object.values(this.sameIndexTimeouts).forEach(t=>clearTimeout(t)),Object.values(this.inactivityTimers).forEach(t=>clearTimeout(t))}SystemStateWeb(){this.socketService.listen("SystemStateWeb").subscribe(t=>{if(console.log(`Received SystemStateWeb for device ${t.deviceId}:`,t),t.state==="shutting_down")this.blockAppState[t.deviceId]=!0,this.blockAds[t.deviceId]=!0,this.schedules=this.schedules.map(e=>{if(e.deviceId.deviceId===t.deviceId)return Y(k({},e),{SystemState:"inactive",appState:"inactive",TVstate:"off",instantData:{titleVideo:"No video available",index:null,error:!0}});let o=this.getLocalStorageState(t.deviceId);return this.updateLocalStorageState(t.deviceId,t.state,o.LastTVstate,!1,!1,o.counterAppState,"shutting_down"),e}),this.cdr.detectChanges();else{let e=this.schedules.find(o=>o.deviceId.deviceId===t.deviceId);e&&e.TVstate==="off"?(this.blockAppState[t.deviceId]=!0,this.blockAds[t.deviceId]=!0):this.blockAppState[t.deviceId]=!1}this.inactivityTimers[t.deviceId]&&clearTimeout(this.inactivityTimers[t.deviceId]),this.schedules=this.schedules.map(e=>e.deviceId.deviceId===t.deviceId?Y(k({},e),{SystemState:t.state}):e),this.cdr.detectChanges(),this.updateStates(t.deviceId),this.updatePagination(),this.cdr.detectChanges()})}TVStateWeb(){this.socketService.listen("TVStateWeb").subscribe(t=>{if(t.state==="off")this.blockAppState[t.deviceId]=!0,this.blockAds[t.deviceId]=!0,this.schedules=this.schedules.map(o=>o.deviceId.deviceId===t.deviceId?Y(k({},o),{TVstate:"off",appState:"inactive",instantData:{titleVideo:"No video available",index:null,error:!0}}):o);else{let o=this.schedules.find(a=>a.deviceId.deviceId===t.deviceId);o&&o.SystemState!=="shutting_down"&&(this.blockAppState[t.deviceId]=!1)}let e=this.getLocalStorageState(t.deviceId);this.startTVStateInactivityTimer(t.deviceId),this.updateLocalStorageState(t.deviceId,e.LastAppState,t.state,e.isAppStateTimePassed,!1,e.counterAppState),this.updateTVState(t.deviceId),this.cdr.detectChanges()})}StateApp(){this.socketService.listen("AppStateWeb").subscribe(t=>{if(this.blockAppState[t.deviceId])return;t.state!=="foreground"?(this.blockAds[t.deviceId]=!0,this.schedules=this.schedules.map(o=>o.deviceId.deviceId===t.deviceId?Y(k({},o),{appState:t.state,instantData:{titleVideo:"No video available",index:null,error:!0}}):(this.cdr.detectChanges(),o))):this.blockAds[t.deviceId]=!1;let e=this.getLocalStorageState(t.deviceId);this.startAppStateInactivityTimer(t.deviceId),this.updateLocalStorageState(t.deviceId,t.state,e.LastTVstate,!1,!1,e.counterAppState),this.updateAppState(t.deviceId),this.cdr.detectChanges()})}subscribeToDeviceUpdates(){if(!this.socketService.isConnected()){console.error("Socket is not connected");return}this.socketService.listen("currentAdWeb").subscribe(t=>{this.blockAds[t.deviceId]||(this.schedules=this.schedules.map(e=>e.deviceId.deviceId===t.deviceId?Y(k({},e),{instantData:{titleVideo:t.title||"No title available for this device",index:t.index+1,error:!1}}):e),this.updatePagination(),this.cdr.detectChanges())})}loadSchedules(){this.loading=!0,this.adminService.getAllSchedule().subscribe({next:t=>{console.log(t),this.schedules=t.data.filter(o=>o.deviceId&&!o.deviceId.isDeleted).map(o=>{let a=this.getLocalStorageState(o.deviceId.deviceId);return Y(k({},o),{advertisementIds:o.advertisementIds.filter(c=>!c.isDeleted),endTime:this.calculateEndTime(o.startTime,o.playTime),appState:a.LastAppState,TVstate:a.LastTVstate,SystemState:a.SystemState})});let e=this.schedules.map(o=>o.deviceId?.deviceId).filter(o=>!!o);this.socketService.emit("checkStates",{devices:e}),this.loading=!1,this.updatePagination()},error:t=>{this.error=t.error?.message||"Error loading schedules",this.loading=!1}})}SecondLoad(){this.loading=!0,this.adminService.getAllSchedule().subscribe({next:t=>{console.log(t),this.schedules=t.data.filter(o=>o.deviceId&&!o.deviceId.isDeleted).map(o=>{let a=this.getLocalStorageState(o.deviceId.deviceId);return Y(k({},o),{advertisementIds:o.advertisementIds.filter(c=>!c.isDeleted),endTime:this.calculateEndTime(o.startTime,o.playTime),appState:a.LastAppState,TVstate:a.LastTVstate,SystemState:a.SystemState})});let e=this.schedules.map(o=>o.deviceId?.deviceId).filter(o=>!!o);this.socketService.emit("checkStates",{devices:e}),this.loading=!1,this.updatePagination()},error:t=>{this.error=t.error?.message||"Error loading schedules",this.loading=!1}})}calculateEndTime(t,e){return new Date(new Date(t).getTime()+e*1e3)}createSchedule(){this.router.navigate(["/admin/schedule/create"])}editSchedule(t){this.router.navigate(["/admin/schedule/edit",t._id])}viewSchedule(t){this.router.navigate(["/admin/schedule/view/"],{queryParams:{scheduleId:t}})}deleteSchedule(t){this.adminService.deleteScheduleById(t).subscribe({next:()=>{this.loadSchedules()},error:e=>{console.error("Error deleting schedule:",e)}})}selectedDeviceId;openModalGods(t){this.selectedDeviceId=t;let e=this.schedules.find(o=>o.deviceId.deviceId===t);this.VariableTitleVd=e?.instantData?.titleVideo||"No title available for this device",this.cdr.detectChanges()}updateStates(t){let e=this.schedules.find(o=>o.deviceId.deviceId===t);if(e){if(e.SystemState==="shutting_down"||e.SystemState==="inactive"){this.logState(t,"All system is shut down");return}if(e.TVstate!=="on"){this.logState(t,"TV is in sleepmode or screen is turned off, please turn on the screen");return}if(e.appState!=="foreground"){this.logState(t,"App is not running or is running in background, check your App");return}if(!e.instantData.titleVideo||e.instantData.error){this.logState(t,"Issue with playlist, probably blocked, try relaunching the playlist by editing the schedule");return}this.logState(t,"All Good"),this.updateLocalStorageState(t,e.appState,e.TVstate,!1,!1,0)}}logState(t,e){console.log(`Device ${t}: ${e}`),this.deviceLogs[t]=e,this.cdr.detectChanges()}updatePagination(){this.totalPages=Math.ceil(this.schedules.length/this.pageSize);let t=this.pageIndex*this.pageSize,e=t+this.pageSize;this.paginatedSchedules=this.schedules.slice(t,e)}nextPage(){this.pageIndex<this.totalPages-1&&(this.pageIndex++,this.updatePagination())}previousPage(){this.pageIndex>0&&(this.pageIndex--,this.updatePagination())}updateLocalStorageState(t,e,o,a,c,b,it){let nt={LastAppState:e,LastTVstate:o,isAppStateTimePassed:a,NoResponse:c,counterAppState:b,SystemState:it};localStorage.setItem(`deviceState_${t}`,JSON.stringify(nt))}getLocalStorageState(t){this.cdr.detectChanges();let e=localStorage.getItem(`deviceState_${t}`);return e?JSON.parse(e):{LastAppState:"background",LastTVstate:"off",isAppStateTimePassed:!1,NoResponse:!1,counterAppState:0,SystemState:"shutting_down"}}updateAppState(t){let e=this.schedules.find(a=>a.deviceId.deviceId===t);if(!e)return;let o=this.getLocalStorageState(t);o.isAppStateTimePassed&&o.NoResponse?e.appState="inactive":e.appState=o.LastAppState,this.cdr.detectChanges()}startAppStateInactivityTimer(t){let e=this.getLocalStorageState(t);this.inactivityTimers[t]&&clearTimeout(this.inactivityTimers[t]),this.inactivityTimers[t]=setTimeout(()=>{this.updateLocalStorageState(t,e.LastAppState,e.LastTVstate,!0,!0,e.counterAppState),this.updateAppState(t),this.cdr.detectChanges()},et)}startTVStateInactivityTimer(t){let e=this.getLocalStorageState(t);this.inactivityTimers[t]&&clearTimeout(this.inactivityTimers[t]),this.inactivityTimers[t]=setTimeout(()=>{this.updateLocalStorageState(t,e.LastAppState,"off",e.isAppStateTimePassed,!0,e.counterAppState),this.updateTVState(t),this.cdr.detectChanges()},ni)}updateTVState(t){this.cdr.detectChanges();let e=this.schedules.find(a=>a.deviceId.deviceId===t);if(!e)return;let o=this.getLocalStorageState(t);o.NoResponse?e.TVstate="off":e.TVstate=o.LastTVstate,this.cdr.detectChanges()}getDeviceStatus(t){return t?t.SystemState==="shutting_down"||t.SystemState==="inactive"?"All system is shut down":t.TVstate!=="on"?"TV is in sleepmode or screen is turned off, please turn on the screen":t.appState!=="foreground"?"App is not running or is running in background, check your App":t.SystemState!=="shutting_down"&&t.TVstate==="on"&&t.appState==="foreground"&&(t.instantData?.error||!t.instantData?.titleVideo)?"Issue with playlist, probably blocked, try relaunching the playlist by editing the schedule":t.SystemState!=="shutting_down"&&t.TVstate==="on"&&t.appState==="foreground"&&t.instantData?.titleVideo&&!t.instantData?.error?"All Good":(this.cdr.detectChanges(),"System status unknown"):"No log available"}static \u0275fac=function(e){return new(e||d)(_(w),_(O),_(te),_(Le),_(Ie))};static \u0275cmp=P({type:d,selectors:[["app-schedule"]],standalone:!1,decls:55,vars:9,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["routerLink","/admin/Devices",1,"btn","btn-primary"],[1,"btn","btn-success",3,"click"],["href","https://cloud.perfumatic.es/login",1,"btn","btn-warning"],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],[1,"thead-dark"],[4,"ngFor","ngForOf"],[1,"pagination-controls"],[3,"click","disabled"],["class","text-center mt-4",4,"ngIf"],["class","alert alert-danger mt-4","role","alert",4,"ngIf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"row"],[1,"col-md-6","mb-3"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[2,"overflow-x","auto !important"],[1,"table","table-bordered",2,"overflow-x","auto !important"],["title","System",1,"mx-2"],[1,"fas","fa-circle",3,"ngClass"],["title","Screen",1,"mx-2"],["title","App",1,"mx-2"],["class","mx-2","title","Playlist",4,"ngIf"],[2,"width","150px","word-wrap","break-word"],[1,"mx-2",3,"ngClass"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"btn","btn-sm","btn-danger","ml-2",3,"click"],["title","Playlist",1,"mx-2"],[1,"fas","fa-circle","dot-red"],[1,"text-center","mt-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger","mt-4"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),r(3,"Schedule List"),i(),n(4,"button",2),r(5," Create New Schedule from Device "),i(),n(6,"button",3),g("click",function(){return o.loadSchedules()}),r(7," Refresh "),i(),n(8,"a",4),r(9," Perfumatic "),i()(),n(10,"div",5)(11,"table",6)(12,"thead",7)(13,"tr")(14,"th"),r(15,"Device Name"),i(),n(16,"th"),r(17,"Advertisements"),i(),n(18,"th"),r(19,"Current Ads"),i(),n(20,"th"),r(21,"God's Eye"),i(),n(22,"th"),r(23,"Actions"),i()()(),n(24,"tbody"),f(25,$t,46,22,"tr",8),i()(),n(26,"div",9)(27,"button",10),g("click",function(){return o.previousPage()}),r(28,"Previous"),i(),n(29,"span"),r(30),i(),n(31,"button",10),g("click",function(){return o.nextPage()}),r(32,"Next"),i()()(),f(33,ei,4,0,"div",11)(34,ti,3,0,"div",11)(35,ii,2,1,"div",12),n(36,"div",13)(37,"div",14)(38,"div",15)(39,"div",16)(40,"h5",17),r(41,"God's Eye View"),i(),p(42,"button",18),i(),n(43,"div",19)(44,"div",20)(45,"div",21)(46,"div",22)(47,"div",23)(48,"h5",24),r(49,"Device Log"),i(),n(50,"p",25),r(51),i()()()()()(),n(52,"div",26)(53,"button",27),r(54," Close "),i()()()()()()),e&2&&(s(25),l("ngForOf",o.paginatedSchedules),s(2),l("disabled",o.pageIndex===0),s(3),G("Page ",o.pageIndex+1," of ",o.totalPages,""),s(),l("disabled",o.pageIndex>=o.totalPages-1),s(2),l("ngIf",o.loading),s(),l("ngIf",!o.loading&&o.schedules.length===0),s(),l("ngIf",o.error),s(16),x(o.deviceLogs[o.selectedDeviceId]||"No log available"))},dependencies:[re,A,I,de],styles:[".table[_ngcontent-%COMP%]{width:100%;margin-bottom:5rem;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle;text-align:center;padding:12px;background-color:#fff;color:#150101;font-size:16px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;font-size:14px;word-break:break-word}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:60px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.btn[_ngcontent-%COMP%]{font-size:14px;padding:5px 10px}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;border-color:#dc3545}.btn[_ngcontent-%COMP%]:hover{opacity:.9}.dot-green[_ngcontent-%COMP%]{color:#0f0}.dot-red[_ngcontent-%COMP%]{color:red}.dot-blinking[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_blinking 1s infinite}@keyframes _ngcontent-%COMP%_blinking{0%{color:#0f0}50%{color:red}to{color:#0f0}}"]})};function oi(d,t){if(d&1){let e=y();n(0,"button",10),g("click",function(){u(e);let a=m();return v(a.toggleEdit())}),r(1,"Edit Schedule"),i()}}function ri(d,t){d&1&&(n(0,"div",11)(1,"div",12)(2,"span",13),r(3,"Loading..."),i()()())}function ai(d,t){if(d&1&&(n(0,"div",14),r(1),i()),d&2){let e=m();s(),h(" ",e.error," ")}}function di(d,t){if(d&1&&(n(0,"div",15),r(1),i()),d&2){let e=m();s(),h(" ",e.success," ")}}function si(d,t){if(d&1&&(n(0,"option",40),r(1),i()),d&2){let e=t.$implicit;l("value",e._id),s(),h(" ",e.name," ")}}function ci(d,t){d&1&&(n(0,"div",41),r(1," Device is required "),i())}function li(d,t){if(d&1){let e=y();n(0,"div",42)(1,"input",43),g("change",function(){let a=u(e).$implicit,c=m(3);return v(c.toggleAdvertisement(a._id))}),i(),n(2,"label",44),r(3),i()()}if(d&2){let e=t.$implicit,o=m(3);s(),l("id","ad_"+e._id)("checked",o.isAdvertisementSelected(e._id)),s(),l("for","ad_"+e._id),s(),h(" ",e.name," ")}}function mi(d,t){d&1&&(n(0,"div",41),r(1," Start time is required "),i())}function pi(d,t){d&1&&(n(0,"span"),r(1,"Play time is required"),i())}function gi(d,t){d&1&&(n(0,"span"),r(1,"Play time must be greater than 0"),i())}function ui(d,t){if(d&1&&(n(0,"div",41),f(1,pi,2,0,"span",19)(2,gi,2,0,"span",19),i()),d&2){let e,o,a=m(3);s(),l("ngIf",(e=a.updateForm.get("playTime"))==null||e.errors==null?null:e.errors.required),s(),l("ngIf",(o=a.updateForm.get("playTime"))==null||o.errors==null?null:o.errors.min)}}function vi(d,t){d&1&&(n(0,"div",41),r(1," Play mode is required "),i())}function fi(d,t){if(d&1){let e=y();n(0,"form",20),g("ngSubmit",function(){u(e);let a=m(2);return v(a.updateSchedule())}),n(1,"div",1)(2,"div",21)(3,"label",22),r(4,"Device"),i(),n(5,"select",23)(6,"option",24),r(7,"Select Device"),i(),f(8,si,2,2,"option",25),i(),f(9,ci,2,0,"div",26),i(),n(10,"div",21)(11,"label",22),r(12,"Advertisements"),i(),n(13,"div",16)(14,"div",27),f(15,li,4,4,"div",28),i()()(),n(16,"div",21)(17,"label",22),r(18,"Start Time"),i(),p(19,"input",29),f(20,mi,2,0,"div",26),i(),n(21,"div",21)(22,"label",22),r(23,"Play Time (seconds)"),i(),p(24,"input",30),f(25,ui,3,2,"div",26),i(),n(26,"div",21)(27,"label",22),r(28,"Play Mode"),i(),n(29,"select",31)(30,"option",32),r(31,"Sequence"),i(),n(32,"option",33),r(33,"Random"),i()(),f(34,vi,2,0,"div",26),i(),n(35,"div",21)(36,"div",34),p(37,"input",35),n(38,"label",36),r(39,"Repeat"),i()()()(),n(40,"div",37)(41,"button",38),g("click",function(){u(e);let a=m(2);return v(a.toggleEdit())}),r(42,"Cancel"),i(),n(43,"button",39),r(44),i()()()}if(d&2){let e,o,a,c,b=m(2);l("formGroup",b.updateForm),s(8),l("ngForOf",b.devices),s(),l("ngIf",((e=b.updateForm.get("deviceId"))==null?null:e.touched)&&((e=b.updateForm.get("deviceId"))==null?null:e.invalid)),s(6),l("ngForOf",b.advertisements),s(5),l("ngIf",((o=b.updateForm.get("startTime"))==null?null:o.touched)&&((o=b.updateForm.get("startTime"))==null?null:o.invalid)),s(5),l("ngIf",((a=b.updateForm.get("playTime"))==null?null:a.touched)&&((a=b.updateForm.get("playTime"))==null?null:a.invalid)),s(9),l("ngIf",((c=b.updateForm.get("playMode"))==null?null:c.touched)&&((c=b.updateForm.get("playMode"))==null?null:c.invalid)),s(10),h(" ",b.loading?"Updating...":"Update Schedule"," ")}}function hi(d,t){if(d&1&&(n(0,"video",51),p(1,"source",52),r(2," Your browser does not support the video tag. "),i()),d&2){let e=m().$implicit;s(),l("src",e.videoUrl,J)}}function _i(d,t){if(d&1&&(n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),f(8,hi,3,1,"video",50),i()()),d&2){let e=t.$implicit;s(2),x(e.name),s(2),x(e.description),s(2),x(e.orientation),s(2),l("ngIf",e.videoUrl)}}function bi(d,t){if(d&1&&(n(0,"div")(1,"div",45)(2,"div",46)(3,"h4"),r(4,"Device Information"),i(),n(5,"p")(6,"strong"),r(7,"Device Name:"),i(),r(8),i(),n(9,"p")(10,"strong"),r(11,"Description:"),i(),r(12),i()(),n(13,"div",46)(14,"h4"),r(15,"Schedule Information"),i(),n(16,"p")(17,"strong"),r(18,"Start Time:"),i(),r(19),E(20,"date"),i(),n(21,"p")(22,"strong"),r(23,"End Time:"),i(),r(24),E(25,"date"),i(),n(26,"p")(27,"strong"),r(28,"Play Mode:"),i(),r(29),i(),n(30,"p")(31,"strong"),r(32,"Repeat:"),i(),r(33),i()()(),n(34,"div",1)(35,"div",2)(36,"h4"),r(37,"Advertisements"),i(),n(38,"div",47)(39,"table",48)(40,"thead")(41,"tr")(42,"th"),r(43,"Name"),i(),n(44,"th"),r(45,"Description"),i(),n(46,"th"),r(47,"Orientation"),i(),n(48,"th"),r(49,"Video"),i()()(),n(50,"tbody"),f(51,_i,9,4,"tr",49),i()()()()()()),d&2){let e=m(2);s(8),h(" ",e.schedule.deviceId==null?null:e.schedule.deviceId.name,""),s(4),h(" ",e.schedule.deviceId==null?null:e.schedule.deviceId.description,""),s(7),h(" ",Pe(20,7,e.schedule.startTime,"medium"),""),s(5),h(" ",Pe(25,10,e.schedule.endTime,"medium"),""),s(5),h(" ",e.schedule.playMode,""),s(4),h(" ",e.schedule.repeat?"Yes":"No",""),s(18),l("ngForOf",e.schedule.advertisementIds)}}function xi(d,t){if(d&1&&(n(0,"div",16)(1,"div",17),f(2,fi,45,8,"form",18)(3,bi,52,13,"div",19),i()()),d&2){let e=m();s(2),l("ngIf",e.isEditing),s(),l("ngIf",!e.isEditing)}}var be=class d{constructor(t,e,o,a){this.route=t;this.adminService=e;this.router=o;this.fb=a;this.updateForm=this.fb.group({deviceId:["",$.required],advertisementIds:[[],$.required],startTime:["",$.required],playTime:["",[$.required,$.min(1)]],playMode:["sequence",$.required],repeat:[!1]})}schedule=null;loading=!1;error="";success="";schedulednewId="";devices=[];advertisements=[];updateForm;isEditing=!1;deviceId="";subscriptions=[];ngOnInit(){this.jibId(),this.loadScheduleDetails(),this.loadDevices(),this.loadAdvertisements()}jibId(){this.subscriptions.push(this.route.queryParams.subscribe(t=>{this.schedulednewId=t.scheduleId,console.log("scheduleId",this.schedulednewId)}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}loadScheduleDetails(){let t=this.schedulednewId;if(!t){this.error="Schedule ID not found";return}this.loading=!0,this.subscriptions.push(this.adminService.getScheduleById(t).subscribe({next:e=>{console.log(e),this.schedule=e.data,Array.isArray(this.schedule.advertisementIds)?this.schedule.advertisementIds=this.schedule.advertisementIds.filter(o=>!o.isDeleted):this.schedule.advertisementIds=[],this.populateForm(),this.loading=!1},error:e=>{this.error=e.error?.message||"Error loading schedule details",this.loading=!1}}))}loadDevices(){this.subscriptions.push(this.adminService.getDevices().subscribe({next:t=>{this.devices=t.data,this.deviceId=t.data._id},error:t=>{console.error("Error loading devices:",t)}}))}loadAdvertisements(){this.adminService.getAds().subscribe({next:t=>{console.log("ADS",t),this.advertisements=t.data.filter(e=>e.isDeleted==!1)},error:t=>{console.error("Error loading advertisements:",t)}})}populateForm(){this.schedule&&(console.log("deviceID",this.schedule.deviceId),this.updateForm.patchValue({deviceId:this.schedule.deviceId,advertisementIds:this.schedule.advertisementIds?.map(t=>t._id)||[],startTime:new Date(this.schedule.startTime).toISOString().slice(0,16),playTime:this.schedule.playTime,playMode:this.schedule.playMode||"sequence",repeat:this.schedule.repeat||!1}))}isAdvertisementSelected(t){return(this.updateForm.get("advertisementIds")?.value||[]).includes(t)}toggleAdvertisement(t){let e=this.updateForm.get("advertisementIds")?.value||[],o;e.includes(t)?o=e.filter(a=>a!==t):o=[...e,t],this.updateForm.patchValue({advertisementIds:o}),this.updateForm.get("advertisementIds")?.markAsTouched()}toggleEdit(){this.isEditing=!this.isEditing,this.isEditing||this.populateForm()}updateSchedule(){let t=this.schedulednewId;this.loading=!0;let e=this.updateForm.value;console.log(e);let o={deviceId:e.deviceId._id,advertisementIds:e.advertisementIds,startTime:new Date(e.startTime).toISOString(),playTime:parseInt(e.playTime),playMode:e.playMode,repeat:e.repeat};this.subscriptions.push(this.adminService.updateSchedule(t,o).subscribe({next:a=>{this.success="Schedule updated successfully",this.schedule=a.data,this.loading=!1,this.isEditing=!1,this.loadScheduleDetails()},error:a=>{this.error=a.error?.message||"Error updating schedule",this.loading=!1}}))}goBack(){this.router.navigate(["/admin/Schedules"])}static \u0275fac=function(e){return new(e||d)(_(ae),_(w),_(O),_(He))};static \u0275cmp=P({type:d,selectors:[["app-view-schedule"]],standalone:!1,decls:14,vars:5,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["class","btn btn-primary me-2",3,"click",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],["class","text-center",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","card",4,"ngIf"],[1,"btn","btn-primary","me-2",3,"click"],[1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"],["role","alert",1,"alert","alert-success"],[1,"card"],[1,"card-body"],["class","mb-4",3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],[1,"mb-4",3,"ngSubmit","formGroup"],[1,"col-md-6","mb-3"],[1,"form-label"],["formControlName","deviceId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"card-body",2,"max-height","200px","overflow-y","auto"],["class","form-check",4,"ngFor","ngForOf"],["type","datetime-local","formControlName","startTime",1,"form-control"],["type","number","formControlName","playTime",1,"form-control"],["formControlName","playMode",1,"form-select"],["value","sequence"],["value","random"],[1,"form-check","mt-4"],["type","checkbox","formControlName","repeat","id","repeat",1,"form-check-input"],["for","repeat",1,"form-check-label"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],[3,"value"],[1,"text-danger"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"row","mb-4"],[1,"col-md-6"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["width","200","controls","",4,"ngIf"],["width","200","controls",""],["type","video/mp4",3,"src"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),r(5,"Schedule Details"),i(),n(6,"div"),f(7,oi,2,0,"button",4),n(8,"button",5),g("click",function(){return o.goBack()}),r(9,"Back to List"),i()()(),f(10,ri,4,0,"div",6)(11,ai,2,1,"div",7)(12,di,2,1,"div",8)(13,xi,4,2,"div",9),i()()()),e&2&&(s(7),l("ngIf",!o.isEditing),s(3),l("ngIf",o.loading),s(),l("ngIf",o.error),s(),l("ngIf",o.success),s(),l("ngIf",!o.loading&&o.schedule))},dependencies:[A,I,L,R,z,D,se,qe,F,T,N,Ye,Ge,Fe],styles:[".card[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0000001a}.card-body[_ngcontent-%COMP%]{padding:2rem}h4[_ngcontent-%COMP%]{color:#333;margin-bottom:1.5rem}.table[_ngcontent-%COMP%]{margin-top:1rem}video[_ngcontent-%COMP%]{border-radius:4px;box-shadow:0 2px 4px #0000001a}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}.form-check[_ngcontent-%COMP%]{margin-bottom:.5rem;padding:.5rem;border-radius:4px;transition:background-color .2s}.form-check[_ngcontent-%COMP%]:hover{background-color:#0000000d}.form-check-input[_ngcontent-%COMP%]{cursor:pointer}.form-check-label[_ngcontent-%COMP%]{cursor:pointer;margin-left:.5rem;-webkit-user-select:none;user-select:none}.scrollable-checkboxes[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;padding-right:.5rem}.scrollable-checkboxes[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.scrollable-checkboxes[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.scrollable-checkboxes[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:3px}.scrollable-checkboxes[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}"]})};var Ci=[{path:"",component:le,children:[{path:"ads",component:me},{path:"newAds",component:pe},{path:"archivedAds",component:ge},{path:"addDevices",component:ue},{path:"Devices",component:ve},{path:"archivedDevices",component:fe},{path:"Makeschedule",component:he},{path:"Schedules",component:_e},{path:"schedule/view",component:be},{path:"",redirectTo:"Schedules",pathMatch:"full"}]}],xe=class d{static \u0275fac=function(e){return new(e||d)};static \u0275mod=oe({type:d});static \u0275inj=ne({imports:[Oe.forChild(Ci),Oe]})};var tt=class d{static \u0275fac=function(e){return new(e||d)};static \u0275mod=oe({type:d});static \u0275inj=ne({providers:[w],imports:[Re,xe,Je,Ke,We,Xe]})};export{tt as AdminModule};
