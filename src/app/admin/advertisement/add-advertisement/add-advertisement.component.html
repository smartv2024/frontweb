<div class="page-container">
  <div class="content-wrapper">
    <div class="page-header">
      <h1 class="page-title">Add New Advertisement</h1>
      <p class="page-subtitle">Upload and configure your advertisement details</p>
    </div>

    <div class="container card pt-5 mt-5 shadow">
      <form #advertisementForm="ngForm">
        <div class="form-group">
          <label for="videoSource">
            <i class="fas fa-film me-2"></i>Video Source
          </label>
          <select
            id="videoSource"
            class="form-control"
            [(ngModel)]="selectedVideoSource"
            name="videoSource"
            required>
            <option value="local" selected>Upload from Computer</option>
          </select>
        </div>

        <div class="form-group" *ngIf="selectedVideoSource === 'local'">
          <label for="videoFile" class="file-upload-label">
            <i class="fas fa-cloud-upload-alt me-2"></i>Choose Video File
          </label>
          <input
            type="file"
            id="videoFile"
            accept="video/*"
            (change)="onFileSelected($event)"
            #fileInput>
          <small class="text-muted d-block">Maximum file size: 100MB</small>
          <div *ngIf="selectedFile" class="mt-2">
            <span class="text-success">Selected file: {{ selectedFile.name }}</span>
          </div>
        </div>

        <div class="mt-3">
          <!-- Enhanced Progress Bar -->
          <div class="upload-progress-container" *ngIf="isUploading">
            <div class="progress mb-2">
              <div 
                class="progress-bar progress-bar-striped progress-bar-animated" 
                role="progressbar" 
                [style.width.%]="uploadProgress"
                [attr.aria-valuenow]="uploadProgress" 
                aria-valuemin="0" 
                aria-valuemax="100">
                {{uploadProgress}}%
              </div>
            </div>
            
            <!-- Detailed progress information -->
            <div class="upload-details text-center mb-3">
              <span class="upload-status">
                <i class="fas fa-sync fa-spin me-2"></i>
                {{ successMessage || 'Uploading video...' }}
              </span>
            </div>
          </div>

          <div *ngIf="estimatedUploadTime && !isUploading" class="text-muted mb-2">
            Estimated upload time: {{ estimatedUploadTime }} seconds
          </div>

          <div class="alert alert-success alert-dismissible fade show" role="alert" *ngIf="successMessage && !isUploading">
            <i class="fas fa-check-circle me-2"></i>{{ successMessage }}
            <button type="button" class="btn-close" (click)="successMessage = ''"></button>
          </div>

          <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="errorMessage">
            <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
            <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
          </div>
        </div>

        <div class="mt-3">
          <button 
            class="btn btn-primary upload-btn" 
            (click)="uploadVideo()" 
            [disabled]="isUploading || (!selectedFile && !youtubeUrl) || isVideoProcessed">
            <i class="fas" [ngClass]="isUploading ? 'fa-spinner fa-spin' : 'fa-upload'"></i>
            <span class="ms-2">
              {{ isVideoProcessed ? 'Video Uploaded' : (isUploading ? 'Uploading...' : 'Upload Video') }}
            </span>
          </button>
        </div>

        <div [class.disabled-form]="!isVideoProcessed">
          <div class="form-group">
            <label for="name">
              <i class="fas fa-tag me-2"></i>Advertisement Name
            </label>
            <input
              type="text"
              id="name"
              class="form-control"
              [(ngModel)]="advertisementObject.name"
              name="name"
              required
              [disabled]="!isVideoProcessed">
          </div>

          <div class="form-group">
            <label for="description">
              <i class="fas fa-align-left me-2"></i>Description
            </label>
            <textarea
              id="description"
              class="form-control"
              [(ngModel)]="advertisementObject.description"
              name="description"
              required
              [disabled]="!isVideoProcessed">
            </textarea>
          </div>

          <div class="form-group">
            <label for="orientation">
              <i class="fas fa-mobile-alt me-2"></i>Orientation
            </label>
            <select
              id="orientation"
              class="form-control"
              [(ngModel)]="advertisementObject.orientation"
              name="orientation"
              required
              [disabled]="!isVideoProcessed">
              <option value="">Select orientation</option>
              <option *ngFor="let orientation of orientations" [value]="orientation">
                {{orientation}}
              </option>
            </select>
          </div>

          <button
            type="submit"
            class="btn btn-success mt-3"
            (click)="addAdvertisement()"
            [disabled]="!isVideoProcessed || isSubmitting || !advertisementForm.form.valid">
            <i class="fas fa-save me-2"></i>
            {{isSubmitting ? 'Saving...' : 'Save Advertisement'}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
