
<div class="container ad-list-container">
    <h2 class="list-title">Advertisement List</h2>

    <div class="row">
        <div class="col">
            <div class="header-section">
                <button class="btn btn-primary add-ad-btn mb-2" (click)="navigateToAddAdvertisement()">
                  <i class="fas fa-plus-circle me-2"></i> Add Advertisement
                </button>
              </div>
        </div>

        <div class="col">
            <div class="search-container">
                <input
                  type="text"
                  class="form-control search-input"
                  placeholder="Search advertisements..."
                  [(ngModel)]="searchTerm"
                />
              </div>
        </div>
    </div>
    
   
    
    <!-- Advertisement Table -->
    <div class="table-responsive">
      <table class="table ad-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th *ngIf="userRole=='admin'">User name</th>
            <th *ngIf="userRole=='admin'">User Email</th>

            <th>Description</th>
            <th>Orientation</th>
            <th>Video URL</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ad of filteredAdvertisements(); let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ ad.name }}</td>
            <td *ngIf="userRole=='admin'">{{ ad.userId?.username || 'N/A' }}</td>
            <td *ngIf="userRole=='admin'">{{ ad.userId?.email || 'N/A' }}</td>
            <td>{{ ad.description }}</td>
            <td>{{ ad.orientation | titlecase }}</td>
            <td>
              <a
                href="javascript:void(0)"
                class="video-link"
                (click)="openModal(ad.videoUrl)"
              >
                <i class="fas fa-video me-2"></i> View Video
              </a>
            </td>
            <td>
              <button class="btn btn-warning me-2" (click)="openEditModal(ad)">
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn btn-info"
                (click)="confirmArchive(ad._id)"
                *ngIf="!ad.archived"
              >
                <i class="fas fa-archive"></i>
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteAdvertisement(ad._id)">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="pagination-container">
        <button
          class="btn btn-secondary me-2"
          [disabled]="currentPage === 1"
          (click)="previousPage()"
        >
          Previous
        </button>
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
        <button
          class="btn btn-secondary ms-2"
          [disabled]="currentPage === totalPages"
          (click)="nextPage()"
        >
          Next
        </button>
      </div>
    
    <!-- Custom Modal for Video -->
    <div class="custom-modal" *ngIf="isModalOpen">
      <div class="modal-overlay" (click)="closeModal()"></div>
      <div class="modal-content">
        <button class="modal-close" (click)="closeModal()">×</button>
        <h5 class="modal-title">Advertisement Video</h5>
        <div class="video-container">
          <video
            *ngIf="selectedVideoUrl"
            [src]="selectedVideoUrl"
            controls
            class="modal-video"
            autoplay
          ></video>
        </div>
      </div>
    </div>
  
    <!-- Edit Modal -->
    <div class="custom-modal" *ngIf="isEditModalOpen">
      <div class="modal-content">
        <button class="modal-close" (click)="closeEditModal()">×</button>
        <h2 class="modal-title">Edit Advertisement</h2>
        
        <form #editForm="ngForm" (ngSubmit)="updateAdvertisement()">
          <!-- Basic Information -->
          <div class="form-group">
            <label for="name">Name</label>
            <input
              id="name"
              class="form-control"
              [(ngModel)]="editAdvertisementObject.name"
              name="name"
              required
            />
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea
              id="description"
              class="form-control"
              [(ngModel)]="editAdvertisementObject.description"
              name="description"
              required
            ></textarea>
          </div>

          <!-- Video Source Selection -->
          <div class="form-group">
            <label for="videoSource">Video Source</label>
            <select
              id="videoSource"
              class="form-control"
              [(ngModel)]="selectedVideoSource"
              name="videoSource"
              required
            >
              <option value="local">Upload from Computer</option>
              <option value="youtube">YouTube Video</option>
            </select>
          </div>

          <!-- Local File Upload -->
          <div class="form-group" *ngIf="selectedVideoSource === 'local'">
            <label for="videoFile" class="file-upload-label">
              <i class="fas fa-cloud-upload-alt me-2"></i>Choose Video File
            </label>
            <input
              type="file"
              id="videoFile"
              accept="video/*"
              (change)="onFileSelected($event)"
              #fileInput
            >
            <small class="text-muted d-block">Maximum file size: 100MB</small>
            <div *ngIf="selectedFile" class="mt-2">
              <span class="text-success">Selected file: {{ selectedFile.name }}</span>
            </div>
          </div>

          <!-- YouTube URL Input -->
          <div class="form-group" *ngIf="selectedVideoSource === 'youtube'">
            <label for="youtubeUrl">YouTube URL</label>
            <div class="input-group">
              <input
                type="text"
                id="youtubeUrl"
                class="form-control"
                [(ngModel)]="youtubeUrl"
                name="youtubeUrl"
                placeholder="Enter YouTube URL"
              >
            
            </div>
          </div>

          <!-- Orientation -->
          <div class="form-group">
            <label for="orientation">Orientation</label>
            <select
              id="orientation"
              class="form-control"
              [(ngModel)]="editAdvertisementObject.orientation"
              name="orientation"
              required
            >
              <option *ngFor="let orientation of orientations" [value]="orientation">
                {{ orientation | titlecase }}
              </option>
            </select>
          </div>

          <!-- Messages -->
          <div class="alert alert-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
          <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>

          <!-- Upload Progress -->
          <div class="upload-status" *ngIf="isUploading">
            <div class="progress mt-3">
              <div 
                class="progress-bar" 
                role="progressbar" 
                [style.width.%]="uploadProgress"
                [attr.aria-valuenow]="uploadProgress" 
                aria-valuemin="0" 
                aria-valuemax="100"
              >
                {{uploadProgress}}%
              </div>
            </div>
            <small class="text-muted">
              {{ uploadProgress < 100 ? 'Updating content...' : 'Processing...' }}
            </small>
          </div>

          <!-- Submit Button -->
          <div class="mt-3">
            <!-- Show this button when video/youtube is selected -->
            <button 
              *ngIf="(selectedVideoSource === 'local' && selectedFile) || (selectedVideoSource === 'youtube' && youtubeUrl)"
              class="btn btn-primary me-2" 
              (click)="updateAdvertisement()"
              [disabled]="isUploading">
              <i class="fas fa-sync-alt me-2"></i>
              {{ isUploading ? 'Updating...' : 'Update with New Video' }}
            </button>

            <!-- Show this button when only updating attributes -->
            <button 
              *ngIf="!(selectedVideoSource === 'local' && selectedFile) && !(selectedVideoSource === 'youtube' && youtubeUrl)"
              class="btn btn-secondary" 
              (click)="updateAdvertisement()"
              [disabled]="isUploading">
              <i class="fas fa-save me-2"></i>
              {{ isUploading ? 'Updating...' : 'Update Details' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  
    <!-- Confirmation Dialog -->
    <div class="custom-modal" *ngIf="isConfirmDialogOpen">
      <div class="modal-overlay" (click)="closeConfirmDialog()"></div>
      <div class="modal-content">
        <h5 class="modal-title">Confirm Archive</h5>
        <p>Are you sure you want to archive this advertisement?</p>
        <div class="dialog-actions">
          <button class="btn btn-danger" (click)="archiveAd(archivingAdId)">Yes</button>
          <button class="btn btn-secondary" (click)="closeConfirmDialog()">No</button>
        </div>
      </div>
    </div>
  </div>
  
