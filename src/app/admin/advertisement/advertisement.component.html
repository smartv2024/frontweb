
<div class="page-wrapper">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Advertisement Management</h1>
      <div class="header-actions">
        <button class="btn-add" (click)="navigateToAddAdvertisement()">
          <i class="fas fa-plus-circle"></i>
          <span>New Advertisement</span>
        </button>
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            placeholder="Search advertisements..."
            [(ngModel)]="searchTerm"
          />
        </div>
      </div>
    </div>

    <!-- Tabs Section -->
    <div class="tabs-container" *ngIf="userRole === 'admin' || userRole === 'SUPERADMIN'">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'all'"
        (click)="switchTab('all')"
      >
        <i class="fas fa-list"></i>
        <span>All Advertisements</span>
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'my'"
        (click)="switchTab('my')"
      >
        <i class="fas fa-user-circle"></i>
        <span>My Advertisements</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="ads-grid">
      <div class="ad-card" *ngFor="let ad of filteredAdvertisements(); let i = index">
        <div class="ad-card-header">
          <span class="ad-number">#{{i + 1}}</span>
          <div class="ad-actions">
            <button class="action-btn edit" (click)="openEditModal(ad)">
              <i class="fas fa-edit"></i>
            </button>
           <!--  <button class="action-btn archive" (click)="confirmArchive(ad._id)" *ngIf="!ad.archived">
              <i class="fas fa-archive"></i>
            </button> -->
            <button class="action-btn delete" (click)="deleteAdvertisement(ad._id)">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>

        <div class="ad-card-content">
          <h3 class="ad-name">{{ad.name}}</h3>
          
          <div class="ad-info">
            <div class="info-group" *ngIf="(userRole === 'admin' || userRole === 'SUPERADMIN') && activeTab === 'all'">
              <label>Created By</label>
              <p>{{ad.userId?.username || 'N/A'}}</p>
              <span class="user-email">{{ad.userId?.email || 'N/A'}}</span>
            </div>

            <div class="info-group">
              <label>Description</label>
              <p>{{ad.description}}</p>
            </div>

            <div class="info-row">
              <div class="info-group">
                <label>Orientation</label>
                <span class="orientation-badge">{{ad.orientation | titlecase}}</span>
              </div>

              <div class="info-group">
                <label>Video</label>
                <button class="video-preview-btn" (click)="openModal(ad.videoUrl)">
                  <i class="fas fa-play-circle"></i>
                  <span>Preview</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <button 
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="previousPage()"
      >
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
      <span class="pagination-info">Page {{currentPage}} of {{totalPages}}</span>
      <button 
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()"
      >
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Video Preview Modal -->
  <div class="custom-modal" *ngIf="isModalOpen">
    <div class="modal-overlay" (click)="closeModal()"></div>
    <div class="modal-content">
      <button class="modal-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
      <h5 class="modal-title">Advertisement Preview</h5>
      <div class="video-container">
        <video
          *ngIf="selectedVideoUrl"
          [src]="selectedVideoUrl"
          controls
          class="modal-video"
          autoplay
        ></video>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="custom-modal" *ngIf="isEditModalOpen">
    <div class="modal-overlay" (click)="closeEditModal()"></div>
    <div class="modal-content">
      <button class="modal-close" (click)="closeEditModal()">
        <i class="fas fa-times"></i>
      </button>
      <h2 class="modal-title">Edit Advertisement</h2>
      
      <form #editForm="ngForm" (ngSubmit)="updateAdvertisement()">
        <!-- Basic Information -->
        <div class="form-group">
          <label for="name">Name</label>
          <input
            id="name"
            class="form-control"
            [(ngModel)]="editAdvertisementObject.name"
            name="name"
            required
          />
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea
            id="description"
            class="form-control"
            [(ngModel)]="editAdvertisementObject.description"
            name="description"
            required
          ></textarea>
        </div>

        <!-- Video Source Selection -->
        <div class="form-group">
          <label for="videoSource">Video Source</label>
          <select
            id="videoSource"
            class="form-control"
            [(ngModel)]="selectedVideoSource"
            name="videoSource"
            required
          >
            <option value="local">Upload from Computer</option>
            <option value="youtube">YouTube Video</option>
          </select>
        </div>

        <!-- Local File Upload -->
        <div class="form-group" *ngIf="selectedVideoSource === 'local'">
          <label for="videoFile" class="file-upload-label">
            <i class="fas fa-cloud-upload-alt me-2"></i>Choose Video File
          </label>
          <input
            type="file"
            id="videoFile"
            accept="video/*"
            (change)="onFileSelected($event)"
            #fileInput
            class="d-none"
          >
          <small class="text-muted d-block">Maximum file size: 100MB</small>
          <div *ngIf="selectedFile" class="mt-2">
            <span class="text-success">Selected file: {{ selectedFile.name }}</span>
          </div>
        </div>

        <!-- YouTube URL Input -->
        <div class="form-group" *ngIf="selectedVideoSource === 'youtube'">
          <label for="youtubeUrl">YouTube URL</label>
          <div class="input-group">
            <input
              type="text"
              id="youtubeUrl"
              class="form-control"
              [(ngModel)]="youtubeUrl"
              name="youtubeUrl"
              placeholder="Enter YouTube URL"
            >
          </div>
        </div>

        <!-- Orientation -->
        <div class="form-group">
          <label for="orientation">Orientation</label>
          <select
            id="orientation"
            class="form-control"
            [(ngModel)]="editAdvertisementObject.orientation"
            name="orientation"
            required
          >
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
        </div>

        <!-- Messages -->
        <div class="alert alert-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
        <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>

        <!-- Upload Progress -->
        <div class="upload-status" *ngIf="isUploading">
          <div class="progress mt-3">
            <div 
              class="progress-bar" 
              role="progressbar" 
              [style.width.%]="uploadProgress"
              [attr.aria-valuenow]="uploadProgress" 
              aria-valuemin="0" 
              aria-valuemax="100"
            >
              {{uploadProgress}}%
            </div>
          </div>
          <small class="text-muted">
            {{ uploadProgress < 100 ? 'Updating content...' : 'Processing...' }}
          </small>
        </div>

        <!-- Submit Buttons -->
        <div class="mt-3">
          <button 
            *ngIf="(selectedVideoSource === 'local' && selectedFile) || (selectedVideoSource === 'youtube' && youtubeUrl)"
            type="button"
            class="btn btn-primary me-2" 
            (click)="updateAdvertisement()"
            [disabled]="isUploading">
            <i class="fas fa-sync-alt me-2"></i>
            {{ isUploading ? 'Updating...' : 'Update with New Video' }}
          </button>

          <button 
            *ngIf="!(selectedVideoSource === 'local' && selectedFile) && !(selectedVideoSource === 'youtube' && youtubeUrl)"
            type="button"
            class="btn btn-secondary" 
            (click)="updateAdvertisement()"
            [disabled]="isUploading">
            <i class="fas fa-save me-2"></i>
            {{ isUploading ? 'Updating...' : 'Update Details' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <div class="custom-modal" *ngIf="isConfirmDialogOpen">
    <div class="modal-overlay" (click)="closeConfirmDialog()"></div>
    <div class="modal-content">
      <h5 class="modal-title">Confirm Archive</h5>
      <p>Are you sure you want to archive this advertisement?</p>
      <div class="dialog-actions">
        <button class="btn btn-danger" (click)="archiveAd(archivingAdId)">Yes</button>
        <button class="btn btn-secondary" (click)="closeConfirmDialog()">No</button>
      </div>
    </div>
  </div>

